<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Mitr', sans-serif;
            background-color: #f8fafc;
            /* slate-50 */
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes modal-scale-in {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes blob-move-1 {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(40px, -60px) scale(1.1);
            }

            50% {
                transform: translate(-30px, 30px) scale(0.9);
            }

            75% {
                transform: translate(20px, 50px) scale(1.2);
            }
        }

        @keyframes blob-move-2 {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(-50px, 30px) scale(1.2);
            }

            50% {
                transform: translate(40px, -40px) scale(0.8);
            }

            75% {
                transform: translate(-20px, -60px) scale(1.1);
            }
        }

        @keyframes blob-move-3 {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(30px, 50px) scale(1.1);
            }

            50% {
                transform: translate(-40px, -20px) scale(0.9);
            }

            75% {
                transform: translate(50px, -30px) scale(1.2);
            }
        }
        
        @keyframes countdown-zoom {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .countdown-number {
            animation: countdown-zoom 1s ease-in-out;
        }

        /* Page transition animations */
        .section-enter-active {
            animation: slide-in-from-top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .section-leave-active {
            animation: slide-out-to-top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes slide-in-from-top {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        @keyframes slide-out-to-top {
             from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(20px);
                opacity: 0;
            }
        }

        .animated-blob {
            filter: blur(80px);
            transition: all 0.3s ease;
        }

        /* Typing indicator animation */
        .typing-indicator span {
            height: 8px;
            width: 8px;
            float: left;
            margin: 0 2px;
            background-color: #9E9EA1;
            display: block;
            border-radius: 50%;
            opacity: 0.4;
            animation: typing 1s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            100% {
                opacity: 0.4;
                transform: scale(0.9);
            }

            50% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Custom scrollbar for chat */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .flip-card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .is-flipped {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        /* Nav active state */
        .nav-link.active {
            border-bottom-color: #4f46e5;
            /* indigo-600 */
            color: #1e293b;
            /* slate-800 */
        }
        
        /* --- Aurora Button Effect --- */
        @keyframes aurora-shimmer {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .aurora-button {
            position: relative;
            overflow: hidden;
            z-index: 1;
            background-color: rgba(107, 33, 168, 0.5); /* fuchsia-800/50 */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }

        .aurora-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            padding-bottom: 150%;
            background: conic-gradient(
                from 180deg at 50% 50%,
                rgba(236, 72, 153, 0.7) 0%, /* Pink */
                rgba(59, 130, 246, 0.7) 70%, /* Blue */
                rgba(236, 72, 153, 0.7) 100%
            );
            z-index: -1;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.5s ease-out;
            animation: aurora-shimmer 5s linear infinite;
        }

        .aurora-button:hover::before {
            opacity: 1;
        }
        .avatar-selection img {
            cursor: pointer;
            border: 4px solid transparent;
            transition: border-color 0.2s ease-in-out;
        }
        .avatar-selection img.selected {
            border-color: #4f46e5; /* indigo-600 */
        }

        /* --- Set Operations Game Styles --- */
        #set-op-drop-zone.drag-over {
            background-color: #dbeafe; /* blue-100 */
            border-color: #6366f1; /* indigo-500 */
        }
        #set-op-element-pool .set-op-element, #set-op-drop-zone .set-op-element {
            cursor: grab;
            background-color: white;
            padding: 8px 16px;
            border-radius: 9999px;
            font-weight: 600;
            font-family: monospace;
            font-size: 1.25rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            transition: transform 0.2s;
        }
        #set-op-element-pool .set-op-element:hover {
            transform: scale(1.1);
        }

        #set-op-drop-zone .set-op-element {
            background-color: #e0e7ff; /* indigo-100 */
            cursor: pointer; /* Can click to remove */
        }

        #set-op-element-pool .dragged {
            opacity: 0.5;
            background-color: #e5e7eb;
        }
         /* --- Venn Diagram Game Styles --- */
        #venn-diagram-container, #venn-3-diagram-container {
            position: relative;
        }
        #venn-diagram-svg, #venn-3-diagram-svg {
            width: 100%;
            height: auto;
        }
        .venn-zone.drag-over-bg {
            fill: rgba(165, 243, 195, 0.5); /* A light green */
        }
        .venn-drop-area {
            position: absolute;
            border-radius: 8px;
            min-height: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 6px;
            align-items: flex-start;
            justify-content: center;
        }
         .venn-drop-area.drag-over {
            background-color: rgba(199, 210, 254, 0.5);
         }
        .venn-element {
             cursor: grab;
            background-color: white;
            color: #1e293b;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 600;
            font-family: monospace;
            font-size: 1.1rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            transition: transform 0.2s;
            user-select: none;
        }
        .venn-element.dragged {
            opacity: 0.5;
        }
    </style>
</head>

<body class="antialiased text-slate-700">

    <section id="login-section" class="relative min-h-screen w-full flex items-center justify-center overflow-hidden transition-opacity duration-500">
        <div class="absolute top-0 left-0 w-full h-full z-0">
            <div class="absolute top-1/4 left-1/4 w-72 h-72 bg-purple-300 rounded-full animated-blob opacity-70" style="animation: blob-move-1 15s infinite ease;"></div>
            <div class="absolute top-1/2 right-1/4 w-80 h-80 bg-blue-300 rounded-full animated-blob opacity-60" style="animation: blob-move-2 18s infinite ease-in-out;"></div>
            <div class="absolute bottom-1/4 left-1/3 w-60 h-60 bg-indigo-300 rounded-full animated-blob opacity-50" style="animation: blob-move-3 12s infinite linear;"></div>
        </div>

        <div id="auth-container" class="relative z-10 w-full max-w-md p-8 space-y-8 bg-white/80 backdrop-blur-xl rounded-2xl shadow-2xl m-4">
            <div id="login-view">
                <div class="text-center">
                    <h2 class="text-4xl font-bold text-slate-800">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
                    <p class="mt-2 text-slate-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                </div>
                <form id="login-form" class="mt-8 space-y-6">
                    <div id="login-error" class="hidden p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
                    <div class="rounded-md shadow-sm -space-y-px">
                        <div>
                            <label for="login-email" class="sr-only">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input id="login-email" name="email" type="email" autocomplete="email" required class="appearance-none rounded-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                        </div>
                        <div>
                            <label for="login-password" class="sr-only">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input id="login-password" name="password" type="password" autocomplete="current-password" required class="appearance-none rounded-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </form>
                <p class="mt-4 text-center text-sm text-slate-600">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" id="show-signup" class="font-medium text-indigo-600 hover:text-indigo-500">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
                </p>
            </div>

            <div id="signup-view" class="hidden">
                 <div class="text-center">
                    <h2 class="text-4xl font-bold text-slate-800">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</h2>
                    <p class="mt-2 text-slate-600">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
                </div>
                <form id="signup-form" class="mt-8 space-y-6">
                    <div id="signup-error" class="hidden p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
                    <div class="rounded-md shadow-sm">
                         <div>
                            <label for="signup-username" class="sr-only">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                            <input id="signup-username" name="username" type="text" required class="appearance-none rounded-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                        </div>
                        <div class="-mt-px">
                            <label for="signup-email" class="sr-only">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input id="signup-email" name="email" type="email" autocomplete="email" required class="appearance-none rounded-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                        </div>
                        <div class="-mt-px">
                            <label for="signup-password" class="sr-only">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input id="signup-password" name="password" type="password" autocomplete="new-password" required class="appearance-none rounded-none relative block w-full px-3 py-3 border border-slate-300 placeholder-slate-500 text-slate-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                        </button>
                    </div>
                </form>
                 <p class="mt-4 text-center text-sm text-slate-600">
                    ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? <a href="#" id="show-login" class="font-medium text-indigo-600 hover:text-indigo-500">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                </p>
            </div>
        </div>
    </section>

    <main id="main-app" class="hidden opacity-0 transition-opacity duration-500 relative min-h-screen flex flex-col" style="animation: fadeIn 0.7s ease-out forwards;">
        <div class="fixed top-0 left-0 w-full h-full z-[-1]">
            <div class="absolute -top-20 -left-20 w-80 h-80 bg-purple-300 rounded-full animated-blob opacity-30" style="animation: blob-move-1 15s infinite ease;"></div>
            <div class="absolute top-1/2 right-1/4 w-96 h-96 bg-blue-300 rounded-full animated-blob opacity-20" style="animation: blob-move-2 18s infinite ease-in-out;"></div>
            <div class="absolute bottom-0 -right-20 w-72 h-72 bg-indigo-300 rounded-full animated-blob opacity-30" style="animation: blob-move-3 12s infinite linear;"></div>
        </div>

        <header class="bg-white/70 backdrop-blur-xl sticky top-0 z-40 shadow-sm border-b border-white/30">
            <div class="mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-indigo-600">SucSet</h1>
                    </div>

                    <div class="hidden md:flex items-center">
                        <nav class="flex space-x-8">
                            <a href="#study-zone" class="nav-link text-slate-500 hover:text-slate-800 px-3 py-2 text-md font-medium border-b-2 border-transparent transition-all duration-300 active">‡πÇ‡∏ã‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</a>
                            <a href="#recap-arcade" class="nav-link text-slate-500 hover:text-slate-800 px-3 py-2 text-md font-medium border-b-2 border-transparent transition-all duration-300">‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</a>
                            <a href="#collab-hub" class="nav-link text-slate-500 hover:text-slate-800 px-3 py-2 text-md font-medium border-b-2 border-transparent transition-all duration-300">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠</a>
                            <a href="#friends-challenge" class="nav-link text-slate-500 hover:text-slate-800 px-3 py-2 text-md font-medium border-b-2 border-transparent transition-all duration-300">‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</a>
                        </nav>

                        <div class="relative ml-6" id="profile-menu">
                            <button id="profile-menu-button" type="button" class="flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-full">
                                <span id="user-name-desktop" class="text-sm font-medium text-slate-700 hidden lg:block"></span>
                                <img id="profile-img-desktop" class="h-9 w-9 rounded-full border-2 border-white shadow-sm object-cover" src="" alt="User Profile">
                            </button>
                            <div id="profile-menu-dropdown" class="hidden absolute right-0 mt-2 w-56 origin-top-right bg-white/80 backdrop-blur-lg rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none py-1 border border-white/30" style="animation: fadeIn 0.15s ease-out;">
                                <div class="px-4 py-2">
                                    <p id="user-name-dropdown" class="text-sm font-semibold text-slate-800"></p>
                                    <p id="user-email-dropdown" class="text-sm text-slate-500 truncate"></p>
                                </div>
                                <div class="border-t border-slate-200/50 my-1"></div>
                                <a href="#profile-page" class="nav-link block px-4 py-2 text-sm text-slate-700 hover:bg-white/50 transition-colors">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
                                <a href="#settings-page" class="nav-link block px-4 py-2 text-sm text-slate-700 hover:bg-white/50 transition-colors">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
                                <div class="border-t border-slate-200/50 my-1"></div>
                                <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-slate-700 hover:bg-white/50 transition-colors">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-lg text-indigo-600 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 transition-colors duration-300">
                            <span class="sr-only">Open main menu</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
             <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 border-b border-slate-200">
                    <a href="#study-zone" class="nav-link text-slate-600 hover:bg-white/50 block px-3 py-2 rounded-md text-base font-medium active">‡πÇ‡∏ã‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</a>
                    <a href="#recap-arcade" class="nav-link text-slate-600 hover:bg-white/50 block px-3 py-2 rounded-md text-base font-medium">‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</a>
                    <a href="#collab-hub" class="nav-link text-slate-600 hover:bg-white/50 block px-3 py-2 rounded-md text-base font-medium">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠</a>
                    <a href="#friends-challenge" class="nav-link text-slate-600 hover:bg-white/50 block px-3 py-2 rounded-md text-base font-medium">‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</a>
                </div>
                <div class="pt-4 pb-3">
                    <div class="flex items-center px-5">
                        <div class="flex-shrink-0">
                            <img id="profile-img-mobile" class="h-10 w-10 rounded-full object-cover" src="" alt="User Profile">
                        </div>
                        <div class="ml-3">
                            <div id="user-name-mobile" class="text-base font-medium text-slate-800"></div>
                            <div id="user-email-mobile" class="text-sm font-medium text-slate-500"></div>
                        </div>
                    </div>
                    <div class="mt-3 px-2 space-y-1">
                        <a href="#profile-page" class="nav-link block rounded-md px-3 py-2 text-base font-medium text-slate-600 hover:bg-white/50">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
                        <a href="#settings-page" class="nav-link block rounded-md px-3 py-2 text-base font-medium text-slate-600 hover:bg-white/50">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
                        <a href="#" id="mobile-logout-btn" class="block rounded-md px-3 py-2 text-base font-medium text-slate-600 hover:bg-white/50">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex-grow mx-auto py-8 px-4 sm:px-6 lg:px-8 w-full">
            <section id="study-zone" class="app-section">
                <h2 class="text-3xl font-bold text-slate-800 mb-6">‡πÇ‡∏ã‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ: ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï</h2>
                <div class="bg-white/70 backdrop-blur-xl p-6 rounded-xl shadow-lg border border-white/30">
                    <div class="flex flex-col lg:flex-row gap-6">

                        <div class="lg:w-[60%] w-full relative">
                            <div id="player" class="aspect-video rounded-lg overflow-hidden bg-black shadow-lg">
                                </div>
                             <canvas id="video-overlay" class="hidden absolute top-0 left-0 w-full h-full pointer-events-none z-10"></canvas>
                        </div>

                        <div class="lg:w-[40%] w-full flex flex-col">
                            <div class="flex flex-col h-full border border-white/30 rounded-lg bg-white/50 backdrop-blur-sm">
                                <div class="p-4 border-b border-white/30">
                                    <h3 class="font-semibold text-slate-800">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI '‡∏ô‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏°'</h3>
                                    <p class="text-sm text-slate-500">‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? ‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
                                </div>
                                <div id="study-chat-box" class="flex-1 p-4 overflow-y-auto custom-scrollbar space-y-4" style="min-height: 250px;">
                                     <div class="flex justify-start">
                                        <div class="bg-white/60 backdrop-blur-lg border border-white/20 p-3 rounded-lg max-w-xs">
                                             <p class="text-sm">
                                                ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏ô‡πâ‡∏≠‡∏á! ‡∏°‡∏≤‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏°‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ üòä<br><br>
                                                <strong>‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á (Empty Set)</strong> ‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠:<br>
                                                ‚Ä¢ <strong>‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏•‡∏¢‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</strong> ‡∏Ñ‡πà‡∏∞<br>
                                                ‚Ä¢ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÜ ‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏•‡∏¢‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏´‡∏•‡∏∞‡∏Ñ‡πà‡∏∞<br><br>
                                                <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô:</strong><br>
                                                ‚Ä¢ ‡πÄ‡∏ã‡∏ï‡∏Ç‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1 (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?)<br>
                                                ‚Ä¢ ‡πÄ‡∏ã‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡∏¥‡∏ô 200 ‡∏õ‡∏µ (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏≠‡∏∞)<br><br>
                                                <strong>‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á:</strong><br>
                                                ‚Ä¢ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‚àÖ (‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏°‡∏µ‡∏Ç‡∏µ‡∏î‡∏ó‡∏±‡∏ö) ‡∏´‡∏£‡∏∑‡∏≠ {} ‡∏Ñ‡πà‡∏∞<br><br>
                                                ‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà "‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤" ‡∏ô‡∏±‡πà‡∏ô‡πÄ‡∏≠‡∏á‡∏Ñ‡πà‡∏∞
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 border-t border-white/30">
                                    <div class="flex space-x-2">
                                        <input type="text" id="study-chat-input" class="flex-1 border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 bg-white/60 backdrop-blur-lg border-white/20" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
                                        <button id="study-chat-send" class="aurora-button px-4 py-2 rounded-lg font-semibold text-sm">‡∏™‡πà‡∏á</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="recap-arcade" class="app-section hidden">
                 <div id="arcade-menu">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <div class="group bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30 text-center cursor-pointer hover:shadow-2xl hover:shadow-blue-500/20 hover:-translate-y-2 transition-all duration-300" id="start-flashcard-mode">
                            <div class="flex justify-center mb-4">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-500 group-hover:scale-110 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                               </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-800 mb-2">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</h3>
                            <p class="text-slate-600">‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤</p>
                        </div>
                        <div class="group bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30 text-center cursor-pointer hover:shadow-2xl hover:shadow-purple-500/20 hover:-translate-y-2 transition-all duration-300" id="start-speed-mode">
                             <div class="flex justify-center mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-purple-500 group-hover:scale-110 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                             </div>
                             <h3 class="text-2xl font-bold text-slate-800 mb-2">‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</h3>
                            <p class="text-slate-600">‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 10 ‡∏Ç‡πâ‡∏≠ ‡∏Ç‡πâ‡∏≠‡∏•‡∏∞ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î!</p>
                        </div>
                        <div class="group bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30 text-center cursor-pointer hover:shadow-2xl hover:shadow-green-500/20 hover:-translate-y-2 transition-all duration-300" id="start-set-operations-game">
                            <div class="flex justify-center mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 group-hover:scale-110 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 11.25V15.75M11.25 11.25V15.75M8.25 15.75V11.25m3-3V6.75m3.75 6.75V6.75m3-3h-15a1.5 1.5 0 00-1.5 1.5v15a1.5 1.5 0 001.5 1.5h15a1.5 1.5 0 001.5-1.5v-15a1.5 1.5 0 00-1.5-1.5z" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-800 mb-2">‡πÄ‡∏Å‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡∏ï</h3>
                            <p class="text-slate-600">‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô, ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å‡∏ä‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á</p>
                        </div>
                         <div class="group bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30 text-center cursor-pointer hover:shadow-2xl hover:shadow-teal-500/20 hover:-translate-y-2 transition-all duration-300" id="start-venn-diagram-game">
                            <div class="flex justify-center mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-teal-500 group-hover:scale-110 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="10.5" cy="10.5" r="7.5" />
                                    <circle cx="13.5" cy="13.5" r="7.5" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-800 mb-2">‡πÄ‡∏Å‡∏°‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡∏ô‡∏ô‡πå (2 ‡πÄ‡∏ã‡∏ï)</h3>
                            <p class="text-slate-600">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡∏ô‡∏ô‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                        </div>
                         <div class="group bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30 text-center cursor-pointer hover:shadow-2xl hover:shadow-rose-500/20 hover:-translate-y-2 transition-all duration-300" id="start-venn-3-diagram-game">
                            <div class="flex justify-center mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-rose-500 group-hover:scale-110 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                     <circle cx="12" cy="8.25" r="4.5" />
                                     <circle cx="8.25" cy="15.75" r="4.5" />
                                     <circle cx="15.75" cy="15.75" r="4.5" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-800 mb-2">‡πÄ‡∏Å‡∏°‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡∏ô‡∏ô‡πå (3 ‡πÄ‡∏ã‡∏ï)</h3>
                            <p class="text-slate-600">‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô 3 ‡πÄ‡∏ã‡∏ï</p>
                        </div>
                    </div>
                     <div class="mt-8 bg-white/70 backdrop-blur-xl p-6 rounded-xl shadow-lg border border-white/30">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h3>
                        <div class="flex items-center space-x-4">
                            <div class="bg-purple-100/80 p-3 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z" />
                                </svg>
                            </div>
                            <div>
                                <p class="text-slate-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß)</p>
                                <p id="arcade-high-score" class="text-2xl font-bold text-slate-800">0</p>
                            </div>
                        </div>
                    </div>
                 </div>

                <div id="flashcard-mode-content" class="hidden flex-col items-center">
                    <button class="back-to-arcade-menu mb-6 text-indigo-600 hover:text-indigo-800">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î</button>
                    <div id="flashcard-container" class="relative w-full max-w-lg h-72 perspective-1000">
                        <div id="flashcard-inner" class="relative w-full h-full text-center flip-card-inner">
                            <div class="absolute w-full h-full p-6 bg-white/70 backdrop-blur-xl rounded-xl shadow-lg border border-white/30 flex items-center justify-center flip-card-front">
                                <p id="flashcard-front-text" class="text-2xl font-semibold"></p>
                            </div>
                            <div class="absolute w-full h-full p-6 bg-indigo-500 text-white rounded-xl shadow-lg flex items-center justify-center flip-card-back">
                                <p id="flashcard-back-text" class="text-xl"></p>
                            </div>
                        </div>
                    </div>
                    <p id="flashcard-counter" class="text-slate-500 mt-4"></p>
                    <div class="mt-6 flex space-x-4">
                        <button id="prev-flashcard" class="px-6 py-2 bg-white/70 backdrop-blur-xl border border-white/30 rounded-lg hover:bg-white/80 transition-colors duration-300">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
                        <button id="flip-flashcard" class="px-8 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors duration-300">‡∏û‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
                        <button id="next-flashcard" class="px-6 py-2 bg-white/70 backdrop-blur-xl border border-white/30 rounded-lg hover:bg-white/80 transition-colors duration-300">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
                    </div>
                </div>

                <div id="speed-quiz-mode-content" class="hidden">
                         <div id="speed-quiz-game-area" class="relative w-full max-w-3xl mx-auto h-[80vh] rounded-2xl shadow-2xl overflow-hidden bg-[#0B0F29]">
                            <div class="absolute top-0 left-0 w-full h-16 bg-[#1D244F] z-30 flex items-center justify-between px-4">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    <span id="speed-quiz-score-top" class="text-white font-bold text-lg">0</span>
                                </div>
                                 <div class="flex items-center space-x-2">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <span id="speed-quiz-timer-top" class="text-white font-bold text-lg">30</span>
                                </div>
                                <button class="back-to-arcade-menu text-white">
                                     <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>

                            <canvas id="background-canvas" class="absolute top-0 left-0 w-full h-full z-0"></canvas>
                            <canvas id="laser-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none z-20"></canvas>
                            <canvas id="confetti-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>
                            
                             <div id="speed-quiz-start-overlay" class="absolute inset-0 bg-black/50 flex flex-col items-center justify-center z-40">
                                <h3 class="text-4xl font-bold text-white mb-2">‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</h3>
                                 <p class="text-white/80 mb-6">‡∏¢‡∏¥‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡∏´‡∏°‡∏î!</p>
                                <button id="speed-quiz-start-btn" class="aurora-button px-10 py-4 font-bold rounded-lg text-lg">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
                            </div>
                            <div id="countdown-overlay" class="hidden absolute inset-0 bg-[#0B0F29]/80 flex-col items-center justify-center z-40 text-white text-9xl font-bold">
                                <span id="countdown-text" class="countdown-number">3</span>
                            </div>
                            <div id="speed-quiz-end-overlay" class="hidden absolute inset-0 bg-[#0B0F29]/90 backdrop-blur-md flex-col items-center justify-center z-40 p-8">
                               <div class="w-full max-w-md text-center">
                                   <img src="https://img.icons8.com/plasticine/100/000000/trophy.png" alt="Trophy" class="mx-auto mb-4 h-24 w-24"/>
                                   <h3 class="text-3xl font-bold text-white mb-2">‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å!</h3>
                                   <p class="text-white/80 text-lg mb-6">‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                                   <div class="flex space-x-4 w-full">
                                       <div class="w-1/2 bg-blue-500/20 backdrop-blur-lg border border-white/20 p-4 rounded-lg text-center">
                                           <p class="text-blue-200 text-sm">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                                           <p id="final-score" class="text-white text-4xl font-bold">0</p>
                                       </div>
                                       <div class="w-1/2 bg-fuchsia-500/20 backdrop-blur-lg border border-white/20 p-4 rounded-lg text-center">
                                           <p class="text-fuchsia-200 text-sm">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</p>
                                           <p id="high-score" class="text-white text-4xl font-bold">0</p>
                                       </div>
                                   </div>
                                   <button id="speed-quiz-restart-btn" class="aurora-button mt-8 w-full py-3 font-bold rounded-lg text-lg">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                                    <button class="back-to-arcade-menu mt-4 w-full py-3 font-semibold rounded-lg text-white/70 hover:text-white transition-colors">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î</button>
                               </div>
                            </div>
                            
                            <div id="speed-quiz-question-area" class="absolute top-20 left-1/2 -translate-x-1/2 w-[90%] max-w-2xl bg-black/40 backdrop-blur-sm p-4 rounded-lg text-white text-center z-30 opacity-100 transition-opacity duration-300">
                                 <p id="speed-quiz-question-text" class="text-xl font-semibold"></p>
                            </div>

                            <div id="shooter-container" class="absolute bottom-4 left-1/2 -translate-x-1/2 w-24 h-24 z-30">
                                 <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M50 0C48.4488 4.29171 44.2917 8.44876 40 10C35.7083 11.5512 30.5833 11.5512 25 10C19.4167 8.44876 15.2596 4.29171 10 0L0 15C4.29171 19.7404 8.44876 24.2211 10 30C11.5512 35.7789 11.5512 41.6667 10 45C8.44876 50.5556 4.29171 55.2596 0 60L10 90C19.4167 85.5833 29.2596 80.7596 40 80H60C70.7404 80.7596 80.5833 85.5833 90 90L100 60C95.7083 55.2596 91.5512 50.5556 90 45C88.4488 39.4444 88.4488 33.5556 90 30C91.5512 24.4444 95.7083 19.7404 100 15L90 0C80.5833 4.41667 70.7404 8.44876 60 10C55.7083 11.5512 51.5512 11.5512 50 10V0Z" fill="url(#paint0_linear_1_2)"/>
                                    <circle cx="50" cy="45" r="12" fill="#24294A" stroke="white" stroke-width="2"/>
                                    <circle cx="50" cy="45" r="5" fill="#7DF0E5"/>
                                    <defs>
                                    <linearGradient id="paint0_linear_1_2" x1="50" y1="0" x2="50" y2="90" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#3D457F"/>
                                    <stop offset="1" stop-color="#24294A"/>
                                    </linearGradient>
                                    </defs>
                                </svg>
                            </div>
                        </div>
                </div>

                <div id="set-operations-game-content" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-slate-800">‡πÄ‡∏Å‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡∏ï</h2>
                        <button class="back-to-arcade-menu text-indigo-600 hover:text-indigo-800">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î</button>
                    </div>

                    <div class="bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30 max-w-4xl mx-auto">
                        <div class="flex justify-between items-center border-b border-slate-200 pb-4 mb-6">
                            <div>
                                <p id="set-op-question" class="text-xl font-semibold text-slate-800"></p>
                            </div>
                            <div class="text-right">
                                <p class="text-slate-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                                <p id="set-op-score" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                        </div>

                        <div class="flex justify-around mb-6 text-center">
                            <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï A</p>
                                <p id="set-a-display" class="text-2xl p-2 bg-blue-100/80 rounded-lg font-mono"></p>
                            </div>
                            <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï B</p>
                                <p id="set-b-display" class="text-2xl p-2 bg-purple-100/80 rounded-lg font-mono"></p>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <p class="font-bold text-lg text-center mb-2">‡πÄ‡∏ã‡∏ï‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏•‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)</p>
                            <div id="set-op-drop-zone" class="min-h-[80px] bg-slate-100/80 rounded-lg p-4 flex flex-wrap gap-3 items-center justify-center border-2 border-dashed border-slate-300">
                                </div>
                        </div>
                        
                        <div class="mb-6">
                            <p class="font-bold text-lg text-center mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                            <div id="set-op-element-pool" class="min-h-[80px] bg-white/50 rounded-lg p-4 flex flex-wrap gap-3 items-center justify-center border border-slate-200">
                                </div>
                        </div>
                        
                        <div id="set-op-feedback" class="text-center mb-4 h-6 font-semibold"></div>
                        <div class="flex justify-center space-x-4">
                             <button id="set-op-reset-btn" class="px-6 py-2 bg-white/70 backdrop-blur-xl border border-white/30 rounded-lg hover:bg-white/80 transition-colors duration-300">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                            <button id="set-op-check-btn" class="px-8 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors duration-300">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                        </div>
                    </div>
                </div>
                
                 <div id="venn-diagram-game-content" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-slate-800">‡πÄ‡∏Å‡∏°‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡∏ô‡∏ô‡πå (2 ‡πÄ‡∏ã‡∏ï)</h2>
                        <button class="back-to-arcade-menu text-indigo-600 hover:text-indigo-800">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î</button>
                    </div>

                    <div class="bg-white/70 backdrop-blur-xl p-6 sm:p-8 rounded-xl shadow-lg border border-white/30 max-w-5xl mx-auto">
                        <div class="flex flex-col sm:flex-row justify-between items-center border-b border-slate-200 pb-4 mb-6 gap-4">
                            <div class="text-center sm:text-left">
                                 <p class="text-lg font-semibold text-slate-800">‡∏•‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û</p>
                                 <p class="text-slate-600">Universal Set U = { <span id="venn-universe-set"></span> }</p>
                            </div>
                            <div class="text-right bg-white/50 p-3 rounded-lg">
                                <p class="text-slate-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                                <p id="venn-score" class="text-2xl font-bold text-teal-600">0</p>
                            </div>
                        </div>
                        
                         <div class="flex justify-around mb-6 text-center">
                            <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï A</p>
                                <p id="venn-set-a-display" class="text-xl p-2 bg-blue-100/80 rounded-lg font-mono"></p>
                            </div>
                            <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï B</p>
                                <p id="venn-set-b-display" class="text-xl p-2 bg-purple-100/80 rounded-lg font-mono"></p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-center">
                            <div class="lg:order-1">
                                <p class="font-bold text-lg text-center mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á</p>
                                <div id="venn-element-pool" class="min-h-[150px] bg-slate-100/80 rounded-lg p-4 flex flex-wrap gap-3 items-center justify-center border-2 border-dashed border-slate-300">
                                    </div>
                            </div>

                            <div id="venn-diagram-container" class="relative lg:col-span-2 lg:order-2">
                                 <svg id="venn-diagram-svg" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <mask id="maskA">
                                            <rect width="100%" height="100%" fill="white"/>
                                            <circle cx="130" cy="60" r="40" fill="black" />
                                        </mask>
                                        <mask id="maskB">
                                            <rect width="100%" height="100%" fill="white"/>
                                            <circle cx="70" cy="60" r="40" fill="black" />
                                        </mask>
                                    </defs>
                                    
                                    <rect id="venn-zone-universe" class="venn-zone" width="200" height="120" rx="10" ry="10" fill="#f1f5f9" stroke="#cbd5e1" />
                                    
                                    <circle id="venn-zone-a" class="venn-zone" cx="70" cy="60" r="40" fill="rgba(59, 130, 246, 0.2)" stroke="#3b82f6" stroke-width="1.5" mask="url(#maskA)" />
                                    <circle id="venn-zone-b" class="venn-zone" cx="130" cy="60" r="40" fill="rgba(168, 85, 247, 0.2)" stroke="#a855f7" stroke-width="1.5" mask="url(#maskB)" />
                                    
                                    <path id="venn-zone-intersection" class="venn-zone" d="M 100 94.64 C 83.43 94.64 68.43 83.43 62.22 68.43 C 68.43 53.43 83.43 42.22 100 42.22 C 116.57 42.22 131.57 53.43 137.78 68.43 C 131.57 83.43 116.57 94.64 100 94.64 Z" fill="rgba(107, 33, 168, 0.3)" />

                                    <text x="35" y="30" font-family="Mitr" font-size="10" fill="#3b82f6" font-weight="bold">A</text>
                                    <text x="160" y="30" font-family="Mitr" font-size="10" fill="#a855f7" font-weight="bold">B</text>
                                </svg>
                                
                                <div id="venn-drop-universe" data-zone="universe" class="venn-drop-area" style="top: 0; left: 0; width: 100%; height: 100%;"></div>
                                <div id="venn-drop-a" data-zone="a" class="venn-drop-area" style="top: 25%; left: 10%; width: 30%; height: 50%; border-radius: 50%;"></div>
                                <div id="venn-drop-b" data-zone="b" class="venn-drop-area" style="top: 25%; right: 10%; width: 30%; height: 50%; border-radius: 50%;"></div>
                                <div id="venn-drop-intersection" data-zone="intersection" class="venn-drop-area" style="top: 30%; left: 42%; width: 16%; height: 40%;"></div>
                            </div>
                        </div>
                        
                        <div id="venn-feedback" class="text-center my-4 h-6 font-semibold"></div>
                        <div class="flex justify-center space-x-4 mt-4">
                            <button id="venn-check-btn" class="px-8 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors duration-300">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                        </div>
                    </div>
                </div>

                 <div id="venn-3-diagram-game-content" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-slate-800">‡πÄ‡∏Å‡∏°‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡∏ô‡∏ô‡πå (3 ‡πÄ‡∏ã‡∏ï)</h2>
                        <button class="back-to-arcade-menu text-indigo-600 hover:text-indigo-800">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î</button>
                    </div>

                    <div class="bg-white/70 backdrop-blur-xl p-6 sm:p-8 rounded-xl shadow-lg border border-white/30 max-w-5xl mx-auto">
                        <div class="flex flex-col sm:flex-row justify-between items-center border-b border-slate-200 pb-4 mb-6 gap-4">
                            <div class="text-center sm:text-left">
                                 <p class="text-lg font-semibold text-slate-800">‡∏•‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û</p>
                                 <p class="text-slate-600">Universal Set U = { <span id="venn-3-universe-set"></span> }</p>
                            </div>
                            <div class="text-right bg-white/50 p-3 rounded-lg">
                                <p class="text-slate-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                                <p id="venn-3-score" class="text-2xl font-bold text-rose-600">0</p>
                            </div>
                        </div>

                         <div class="flex justify-around mb-6 text-center gap-4">
                            <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï A</p>
                                <p id="venn-3-set-a-display" class="text-md p-2 bg-blue-100/80 rounded-lg font-mono"></p>
                            </div>
                            <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï B</p>
                                <p id="venn-3-set-b-display" class="text-md p-2 bg-purple-100/80 rounded-lg font-mono"></p>
                            </div>
                             <div>
                                <p class="font-bold text-lg">‡πÄ‡∏ã‡∏ï C</p>
                                <p id="venn-3-set-c-display" class="text-md p-2 bg-green-100/80 rounded-lg font-mono"></p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-center">
                            <div class="lg:order-1">
                                <p class="font-bold text-lg text-center mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á</p>
                                <div id="venn-3-element-pool" class="min-h-[150px] bg-slate-100/80 rounded-lg p-4 flex flex-wrap gap-3 items-center justify-center border-2 border-dashed border-slate-300">
                                    </div>
                            </div>

                            <div id="venn-3-diagram-container" class="relative lg:col-span-2 lg:order-2">
                                <svg id="venn-3-diagram-svg" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="200" height="150" rx="10" ry="10" fill="#f1f5f9" stroke="#cbd5e1" />
                                    <circle cx="100" cy="55" r="40" fill="rgba(239, 68, 68, 0.2)" stroke="#ef4444" stroke-width="1.5" />
                                    <circle cx="75" cy="95" r="40" fill="rgba(59, 130, 246, 0.2)" stroke="#3b82f6" stroke-width="1.5" />
                                    <circle cx="125" cy="95" r="40" fill="rgba(34, 197, 94, 0.2)" stroke="#22c55e" stroke-width="1.5" />
                                    
                                     <text x="100" y="25" font-family="Mitr" font-size="10" fill="#ef4444" font-weight="bold" text-anchor="middle">A</text>
                                    <text x="45" y="130" font-family="Mitr" font-size="10" fill="#3b82f6" font-weight="bold">B</text>
                                    <text x="155" y="130" font-family="Mitr" font-size="10" fill="#22c55e" font-weight="bold">C</text>
                                </svg>
                                
                                <div id="venn-3-drop-universe" data-zone="universe" class="venn-drop-area" style="top: 0; left: 0; width: 100%; height: 100%;"></div>
                                <div id="venn-3-drop-a" data-zone="a_only" class="venn-drop-area" style="top: 15%; left: 42%; width: 16%; height: 20%;"></div>
                                <div id="venn-3-drop-b" data-zone="b_only" class="venn-drop-area" style="top: 60%; left: 15%; width: 20%; height: 25%;"></div>
                                <div id="venn-3-drop-c" data-zone="c_only" class="venn-drop-area" style="top: 60%; right: 15%; width: 20%; height: 25%;"></div>
                                <div id="venn-3-drop-ab" data-zone="ab_only" class="venn-drop-area" style="top: 40%; left: 29%; width: 15%; height: 20%;"></div>
                                <div id="venn-3-drop-ac" data-zone="ac_only" class="venn-drop-area" style="top: 40%; right: 29%; width: 15%; height: 20%;"></div>
                                <div id="venn-3-drop-bc" data-zone="bc_only" class="venn-drop-area" style="bottom: 8%; left: 42%; width: 16%; height: 20%;"></div>
                                <div id="venn-3-drop-abc" data-zone="abc_intersect" class="venn-drop-area" style="top: 52%; left: 42%; width: 16%; height: 20%;"></div>
                            </div>
                        </div>
                        
                        <div id="venn-3-feedback" class="text-center my-4 h-6 font-semibold"></div>
                        <div class="flex justify-center space-x-4 mt-4">
                            <button id="venn-3-check-btn" class="px-8 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors duration-300">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                        </div>
                    </div>
                </div>

            </section>

            <section id="collab-hub" class="app-section hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-6">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="md:col-span-2 bg-white/70 backdrop-blur-xl rounded-xl shadow-lg border border-white/30 p-6">
                        <h3 class="text-xl font-semibold mb-4">‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ</h3>
                        <div class="h-96 border border-white/30 rounded-lg mb-4 p-4 overflow-y-auto custom-scrollbar">
                           <p class="text-slate-500 text-center">‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏ä‡∏ó‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ!</p>
                        </div>
                        <div class="flex space-x-2">
                           <input type="text" class="flex-1 border-slate-300 bg-white/70 rounded-lg" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." disabled>
                           <button class="bg-slate-300 text-white px-4 py-2 rounded-lg cursor-not-allowed">‡∏™‡πà‡∏á</button>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="bg-white/70 backdrop-blur-xl rounded-xl shadow-lg border border-white/30 p-6">
                            <h3 class="text-xl font-semibold mb-4">AI ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå</h3>
                            <p class="text-slate-600 mb-4">‡∏ï‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏¢‡∏≤‡∏Å‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? ‡πÉ‡∏´‡πâ AI ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì</p>
                            <button id="open-ai-solver-btn" class="aurora-button w-full font-semibold py-3 rounded-lg transition-all duration-300">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô AI Solver</button>
                        </div>
                        <div class="bg-white/70 backdrop-blur-xl rounded-xl shadow-lg border border-white/30 p-6">
                            <h3 class="text-xl font-semibold mb-4">‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</h3>
                            <ul class="space-y-3">
                                <li class="flex items-center justify-between">
                                    <span class="text-slate-700">‡∏™‡∏°‡∏ä‡∏≤‡∏¢</span>
                                    <span class="text-xs font-semibold bg-green-100/80 text-green-800 px-2 py-1 rounded-full">Online</span>
                                </li>
                               <li class="flex items-center justify-between">
                                    <span class="text-slate-700">‡∏™‡∏°‡∏®‡∏£‡∏µ</span>
                                     <span class="text-xs font-semibold bg-green-100/80 text-green-800 px-2 py-1 rounded-full">Online</span>
                                </li>
                               <li class="flex items-center justify-between">
                                    <span class="text-slate-700">‡∏°‡∏≤‡∏ô‡∏µ</span>
                                     <span class="text-xs font-semibold bg-slate-200/80 text-slate-800 px-2 py-1 rounded-full">Offline</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="friends-challenge" class="app-section hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-6">‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô: ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h2>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                      <div class="md:col-span-2 bg-white/70 backdrop-blur-xl rounded-xl shadow-lg border border-white/30 p-8 text-center flex flex-col justify-center items-center">
                           <h3 class="text-2xl font-semibold mb-2 text-slate-800">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï!</h3>
                           <p class="text-slate-600 mb-6">‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 30 ‡∏Ç‡πâ‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏ï‡πà‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ<br><span class="text-xs text-indigo-500 font-semibold">‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ AI</span></p>
                           <button id="start-quiz-btn" class="aurora-button px-10 py-4 font-bold rounded-lg transition-all duration-300 shadow-lg text-lg">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</button>
                      </div>
                      <div class="bg-white/70 backdrop-blur-xl rounded-xl shadow-lg border border-white/30 p-6">
                           <h3 class="text-xl font-semibold mb-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                           <ol class="space-y-4">
                                <li class="flex items-center space-x-3">
                                   <span class="font-bold text-lg text-yellow-500">1</span>
                                   <div class="flex-1">
                                       <p class="font-semibold text-slate-800">‡∏Ñ‡∏∏‡∏ì</p>
                                       <p class="text-sm text-slate-500">150 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô | ‡∏™‡∏ï‡∏£‡∏µ‡∏Ñ 5 üî•</p>
                                   </div>
                                </li>
                                <li class="flex items-center space-x-3">
                                   <span class="font-bold text-lg text-slate-400">2</span>
                                   <div class="flex-1">
                                       <p class="font-semibold text-slate-800">‡∏™‡∏°‡∏ä‡∏≤‡∏¢</p>
                                       <p class="text-sm text-slate-500">125 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô | ‡∏™‡∏ï‡∏£‡∏µ‡∏Ñ 3</p>
                                   </div>
                                </li>
                                <li class="flex items-center space-x-3">
                                   <span class="font-bold text-lg text-orange-400">3</span>
                                   <div class="flex-1">
                                       <p class="font-semibold text-slate-800">‡∏™‡∏°‡∏®‡∏£‡∏µ</p>
                                       <p class="text-sm text-slate-500">110 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô | ‡∏™‡∏ï‡∏£‡∏µ‡∏Ñ 2</p>
                                   </div>
                                </li>
                           </ol>
                      </div>
                 </div>
            </section>
            
            <section id="profile-page" class="app-section hidden">
                <h2 class="text-3xl font-bold text-slate-800 mb-6">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h2>
                <div class="max-w-2xl mx-auto bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30">
                    <form id="profile-form">
                        <div class="flex flex-col items-center space-y-6">
                            <img id="profile-page-avatar" class="h-32 w-32 rounded-full object-cover border-4 border-indigo-200" src="" alt="Current Avatar">
                            
                            <div>
                                <label for="profile-username" class="block text-sm font-medium text-slate-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                <input type="text" id="profile-username" class="w-full border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà</label>
                                <div id="avatar-selection-grid" class="grid grid-cols-5 gap-4 avatar-selection">
                                    </div>
                            </div>
                            
                            <button type="submit" class="w-full py-3 px-4 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors duration-300">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                            </button>
                            <div id="profile-success-message" class="hidden text-green-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
                        </div>
                    </form>
                </div>
            </section>

            <section id="settings-page" class="app-section hidden">
                 <h2 class="text-3xl font-bold text-slate-800 mb-6">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>
                 <div class="max-w-2xl mx-auto space-y-8">
                      <div class="bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30">
                          <h3 class="text-xl font-bold text-slate-800 mb-4">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h3>
                          <form id="change-email-form" class="space-y-4">
                            <div id="email-success-message" class="hidden p-3 bg-green-100 text-green-700 rounded-lg text-sm"></div>
                            <div id="email-error-message" class="hidden p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
                            <div>
                                <label for="new-email" class="block text-sm font-medium text-slate-700 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡∏°‡πà</label>
                                <input type="email" id="new-email" required class="w-full border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <button type="submit" class="w-full py-2 px-4 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-800 transition-colors">
                                ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                            </button>
                          </form>
                     </div>
                      <div class="bg-white/70 backdrop-blur-xl p-8 rounded-xl shadow-lg border border-white/30">
                          <h3 class="text-xl font-bold text-slate-800 mb-4">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
                          <form id="change-password-form" class="space-y-4">
                            <div id="password-success-message" class="hidden p-3 bg-green-100 text-green-700 rounded-lg text-sm"></div>
                            <div id="password-error-message" class="hidden p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
                            <div>
                                <label for="new-password" class="block text-sm font-medium text-slate-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                                <input type="password" id="new-password" required class="w-full border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                             <button type="submit" class="w-full py-2 px-4 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-800 transition-colors">
                                ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
                            </button>
                          </form>
                     </div>
                 </div>
            </section>
        </div>
    </main>

    <div id="ai-quiz-loading-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
        <div class="bg-white/70 backdrop-blur-xl border border-white/30 rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center" style="animation: modal-scale-in 0.3s ease-out forwards;">
            <div class="flex justify-center items-center mb-4">
                <svg class="animate-spin h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-slate-800">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</h3>
            <p class="text-slate-600">‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
        </div>
    </div>
    
    <div id="quiz-modal" class="hidden fixed inset-0 bg-white z-50 flex flex-col p-4 sm:p-6 lg:p-8" style="animation: fadeIn 0.3s ease-out forwards;">
        <div id="quiz-header" class="w-full max-w-4xl mx-auto mb-4">
            <div class="flex justify-between items-center mb-2">
                 <h2 class="text-xl font-bold text-slate-800">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï</h2>
                 <button id="close-quiz-btn" class="text-slate-500 hover:text-slate-800 text-2xl font-bold">√ó</button>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2.5">
                <div id="quiz-progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
        <div id="quiz-content" class="flex-grow w-full max-w-4xl mx-auto flex flex-col justify-center">
            </div>
    </div>
    
    <div id="ai-solver-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4">
        <div class="bg-white/70 backdrop-blur-xl border border-white/30 rounded-2xl shadow-2xl w-full max-w-xl flex flex-col h-[80vh] relative" style="animation: modal-scale-in 0.3s ease-out forwards;">
            <div class="p-4 border-b border-white/30">
                <h3 class="font-semibold text-slate-800 text-lg">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå '‡∏ô‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏°'</h3>
                <p class="text-sm text-slate-500">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
            </div>
            <div id="solver-chat-box" class="flex-1 p-4 overflow-y-auto custom-scrollbar space-y-4">
                 <div class="flex justify-start">
                    <div class="bg-white/60 backdrop-blur-lg border border-white/20 p-3 rounded-lg max-w-md">
                        <p class="text-sm">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏°‡∏µ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡∏Ç‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏Ñ‡∏∞? ‡∏•‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-white/30">
                <div class="flex space-x-2">
                    <input type="text" id="solver-chat-input" class="flex-1 border-slate-300 rounded-lg bg-white/60 backdrop-blur-lg border-white/20 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
                    <button id="solver-chat-send" class="aurora-button px-4 py-2 rounded-lg font-semibold text-sm">‡∏™‡πà‡∏á</button>
                </div>
            </div>
            <button id="close-ai-solver-btn" class="absolute top-3 right-3 text-slate-500 hover:text-slate-800 text-2xl font-bold transition-colors duration-300">√ó</button>
        </div>
    </div>


    <script>
        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDYi6Ozmf6vEWkWg49QC5MuyJAvt7a-xZc",
            authDomain: "secset-542cb.firebaseapp.com",
            projectId: "secset-542cb",
            storageBucket: "secset-542cb.appspot.com",
            messagingSenderId: "735349862292",
            appId: "1:735349862292:web:a86d3f77dd3b7153d4a981",
            measurementId: "G-Y6V4MV1XGB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        try {
            db.settings({ experimentalForceLongPolling: true });
        } catch(e) {
            console.warn("Could not set Firestore long polling:", e);
        }


        // --- YouTube Player API Logic ---
        let ytPlayer;
        function onYouTubeIframeAPIReady() {
            ytPlayer = new YT.Player('player', {
                height: '360',
                width: '640',
                videoId: 'bYRwxh0LdHk',
                playerVars: {
                    'playsinline': 1,
                    'modestbranding': 1,
                    'rel': 0
                }
            });
        }
        
        function showHighlightOnVideo(payload) {
            if (!ytPlayer || typeof ytPlayer.seekTo !== 'function') return;

            const { timestamp, x, y, radius } = payload;
            
            ytPlayer.pauseVideo();
            ytPlayer.seekTo(timestamp, true);

            const canvas = document.getElementById('video-overlay');
            const playerDiv = document.getElementById('player');
            const ctx = canvas.getContext('2d');

            const rect = playerDiv.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const absX = canvas.width * x;
            const absY = canvas.height * y;

            ctx.beginPath();
            ctx.arc(absX, absY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = 'rgba(255, 0, 0, 0.9)';
            ctx.lineWidth = 4;
            ctx.stroke();

            canvas.classList.remove('hidden');
            setTimeout(() => {
                canvas.classList.add('hidden');
            }, 3000);
        }


        document.addEventListener('DOMContentLoaded', () => {

            const loginSection = document.getElementById('login-section');
            const mainApp = document.getElementById('main-app');
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.app-section');
            let currentSection = document.querySelector('.app-section:not(.hidden)');
            let isTransitioning = false;
            
            const avatarFiles = [
                'https://api.dicebear.com/7.x/bottts/svg?seed=Annie',
                'https://api.dicebear.com/7.x/bottts/svg?seed=Sammy',
                'https://api.dicebear.com/7.x/bottts/svg?seed=Gizmo',
                'https://api.dicebear.com/7.x/bottts/svg?seed=Midnight',
                'https://api.dicebear.com/7.x/bottts/svg?seed=Peanut'
            ];
            
            const populateAvatarSelection = () => {
                const grid = document.getElementById('avatar-selection-grid');
                if (!grid) return;
                grid.innerHTML = '';
                avatarFiles.forEach(fileUrl => {
                    const img = document.createElement('img');
                    img.src = fileUrl;
                    img.dataset.filename = fileUrl;
                    img.classList.add('h-16', 'w-16', 'rounded-full', 'object-cover');
                    grid.appendChild(img);
                });
            };
            populateAvatarSelection();

            const showMainApp = (user) => {
                const userName = user.displayName || user.email.split('@')[0];
                const userEmail = user.email;
                const photoURL = user.photoURL || avatarFiles[0];

                document.getElementById('user-name-desktop').textContent = userName;
                document.getElementById('user-name-dropdown').textContent = userName;
                document.getElementById('user-email-dropdown').textContent = userEmail;
                document.getElementById('user-name-mobile').textContent = userName;
                document.getElementById('user-email-mobile').textContent = userEmail;
                document.getElementById('profile-img-desktop').src = photoURL;
                document.getElementById('profile-img-mobile').src = photoURL;
                document.getElementById('profile-page-avatar').src = photoURL;
                document.getElementById('profile-username').value = userName;
                
                loginSection.classList.add('opacity-0');
                setTimeout(() => {
                    loginSection.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    setTimeout(() => mainApp.classList.remove('opacity-0'), 50); 
                }, 500);

                db.collection('users').doc(user.uid).get().then(userDoc => {
                    if (!userDoc.exists) {
                        console.warn("User document doesn't exist. This might be the first login.");
                        return;
                    }
                    const userData = userDoc.data();
                    
                    const firestorePhotoURL = userData.photoURL || photoURL;
                    document.getElementById('profile-img-desktop').src = firestorePhotoURL;
                    document.getElementById('profile-img-mobile').src = firestorePhotoURL;
                    document.getElementById('profile-page-avatar').src = firestorePhotoURL;

                    document.querySelectorAll('#avatar-selection-grid img').forEach(img => {
                        img.classList.remove('selected');
                        if (img.src === firestorePhotoURL) {
                            img.classList.add('selected');
                        }
                    });

                }).catch(error => {
                    console.error("Error fetching user data from Firestore:", error.code, error.message);
                });
            };

            const showLoginScreen = () => {
                 mainApp.classList.add('opacity-0');
                setTimeout(() => {
                    mainApp.classList.add('hidden');
                    loginSection.classList.remove('hidden');
                    setTimeout(() => loginSection.classList.remove('opacity-0'), 50);
                }, 500);
            };

            // --- Firebase Auth Logic ---
            const loginView = document.getElementById('login-view');
            const signupView = document.getElementById('signup-view');
            const showSignupBtn = document.getElementById('show-signup');
            const showLoginBtn = document.getElementById('show-login');
            
            showSignupBtn.addEventListener('click', (e) => {
                e.preventDefault();
                loginView.classList.add('hidden');
                signupView.classList.remove('hidden');
            });

            showLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signupView.classList.add('hidden');
                loginView.classList.remove('hidden');
            });


            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginError = document.getElementById('login-error');
            const signupError = document.getElementById('signup-error');

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = loginForm.email.value;
                const password = loginForm.password.value;

                auth.signInWithEmailAndPassword(email, password)
                    .catch(err => {
                        console.error("Login Error:", err.code, err.message);
                        let friendlyMessage = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
                        if (err.code === 'auth/invalid-email' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found' || err.code === 'auth/invalid-credential') {
                            friendlyMessage = "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
                        }
                        loginError.textContent = friendlyMessage;
                        loginError.classList.remove('hidden');
                    });
            });

            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = signupForm.username.value;
                const email = signupForm.email.value;
                const password = signupForm.password.value;
                
                if (!username) {
                    signupError.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ";
                    signupError.classList.remove('hidden');
                    return;
                }

                auth.createUserWithEmailAndPassword(email, password)
                    .then(userCredential => {
                        const user = userCredential.user;
                        const randomAvatar = avatarFiles[Math.floor(Math.random() * avatarFiles.length)];
                        
                        return user.updateProfile({
                            displayName: username,
                            photoURL: randomAvatar
                        }).then(() => {
                            return db.collection('users').doc(user.uid).set({
                                username: username,
                                email: email,
                                photoURL: randomAvatar,
                                highScore: 0,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                    })
                    .catch(err => {
                        console.error("Signup Error:", err.code, err.message);
                        let friendlyMessage = "";
                        switch (err.code) {
                            case 'auth/email-already-in-use':
                                friendlyMessage = "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
                                break;
                            case 'auth/invalid-email':
                                friendlyMessage = "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
                                break;
                            case 'auth/weak-password':
                                friendlyMessage = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£";
                                break;
                            default:
                                friendlyMessage = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}`;
                                break;
                        }
                        signupError.textContent = friendlyMessage;
                        signupError.classList.remove('hidden');
                    });
            });


            auth.onAuthStateChanged(user => {
                if (user) {
                    showMainApp(user);
                } else {
                    showLoginScreen();
                }
            });


            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (isTransitioning) return;

                    const targetId = link.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);

                    if (currentSection !== targetSection) {
                        isTransitioning = true;
                        
                        if (currentSection) {
                            currentSection.classList.add('section-leave-active');
                        }
                        
                        setTimeout(() => {
                            if (currentSection) {
                                currentSection.classList.add('hidden');
                                currentSection.classList.remove('section-leave-active');
                            }
                            
                            targetSection.classList.remove('hidden');
                            targetSection.classList.add('section-enter-active');
                            currentSection = targetSection;
                            
                            setTimeout(() => {
                                targetSection.classList.remove('section-enter-active');
                                isTransitioning = false;
                            }, 500);

                        }, 250);
                    }

                    navLinks.forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll(`.nav-link[href="#${targetId}"]`).forEach(activeLink => {
                         activeLink.classList.add('active');
                    });
                    
                    if (document.getElementById('mobile-menu').classList.contains('hidden') === false) {
                        document.getElementById('mobile-menu').classList.add('hidden');
                    }
                });
            });

            document.getElementById('mobile-menu-button').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });

            const profileMenu = document.getElementById('profile-menu');
            const profileMenuButton = document.getElementById('profile-menu-button');
            const profileMenuDropdown = document.getElementById('profile-menu-dropdown');
            const logoutBtn = document.getElementById('logout-btn');
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');

            const handleLogout = (e) => {
                e.preventDefault();
                auth.signOut();
            };

            if (profileMenuButton) {
                profileMenuButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    profileMenuDropdown.classList.toggle('hidden');
                });
            }

            window.addEventListener('click', (e) => {
                if (profileMenu && !profileMenu.contains(e.target)) {
                    profileMenuDropdown.classList.add('hidden');
                }
            });

            logoutBtn.addEventListener('click', handleLogout);
            mobileLogoutBtn.addEventListener('click', handleLogout);

            const profileForm = document.getElementById('profile-form');
            const avatarSelectionGrid = document.getElementById('avatar-selection-grid');
            let selectedAvatarFile = null;

            avatarSelectionGrid.addEventListener('click', (e) => {
                if (e.target.tagName === 'IMG') {
                    avatarSelectionGrid.querySelectorAll('img').forEach(img => img.classList.remove('selected'));
                    e.target.classList.add('selected');
                    selectedAvatarFile = e.target.dataset.filename;
                }
            });

            profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newUsername = document.getElementById('profile-username').value;
                const user = auth.currentUser;
                const profileSuccessMessage = document.getElementById('profile-success-message');

                if (user) {
                    const updates = {};
                    if (newUsername !== user.displayName) {
                        updates.displayName = newUsername;
                    }
                    if (selectedAvatarFile) {
                        updates.photoURL = selectedAvatarFile;
                    }

                    user.updateProfile(updates).then(() => {
                        const firestoreUpdates = {};
                         if (newUsername !== user.displayName) {
                             firestoreUpdates.username = newUsername;
                        }
                        if (selectedAvatarFile) {
                             firestoreUpdates.photoURL = selectedAvatarFile;
                        }
                        return db.collection('users').doc(user.uid).update(firestoreUpdates);
                    }).then(() => {
                        profileSuccessMessage.classList.remove('hidden');
                        setTimeout(() => profileSuccessMessage.classList.add('hidden'), 3000);
                        showMainApp(auth.currentUser);
                    }).catch(error => {
                        console.error("Error updating profile: ", error);
                    });
                }
            });

            const changeEmailForm = document.getElementById('change-email-form');
            changeEmailForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newEmail = document.getElementById('new-email').value;
                const user = auth.currentUser;
                const emailSuccessMessage = document.getElementById('email-success-message');
                const emailErrorMessage = document.getElementById('email-error-message');
                
                if (user && newEmail) {
                    user.updateEmail(newEmail).then(() => {
                        emailSuccessMessage.textContent = "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!";
                        emailSuccessMessage.classList.remove('hidden');
                        setTimeout(() => emailSuccessMessage.classList.add('hidden'), 3000);
                    }).catch(error => {
                        emailErrorMessage.textContent = error.message;
                        emailErrorMessage.classList.remove('hidden');
                          setTimeout(() => emailErrorMessage.classList.add('hidden'), 3000);
                    });
                }
            });

              const changePasswordForm = document.getElementById('change-password-form');
              changePasswordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newPassword = document.getElementById('new-password').value;
                const user = auth.currentUser;
                const passwordSuccessMessage = document.getElementById('password-success-message');
                const passwordErrorMessage = document.getElementById('password-error-message');

                if (user && newPassword) {
                    user.updatePassword(newPassword).then(() => {
                        passwordSuccessMessage.textContent = "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!";
                        passwordSuccessMessage.classList.remove('hidden');
                        setTimeout(() => passwordSuccessMessage.classList.add('hidden'), 3000);
                    }).catch(error => {
                        passwordErrorMessage.textContent = error.message;
                        passwordErrorMessage.classList.remove('hidden');
                          setTimeout(() => passwordErrorMessage.classList.add('hidden'), 3000);
                    });
                }
            });

            const aiSolverModal = document.getElementById('ai-solver-modal');
            const openAiSolverBtn = document.getElementById('open-ai-solver-btn');
            const closeAiSolverBtn = document.getElementById('close-ai-solver-btn');

            if(openAiSolverBtn) {
                openAiSolverBtn.addEventListener('click', () => {
                    aiSolverModal.classList.remove('hidden');
                });
            }
            
            if(closeAiSolverBtn) {
                closeAiSolverBtn.addEventListener('click', () => {
                    aiSolverModal.classList.add('hidden');
                });
            }
            
            const callGeminiAPI = (prompt, chatBoxId, persona) => {
                const typingIndicatorId = `typing-${Date.now()}`;
                appendMessage({ text: '' }, 'ai', chatBoxId, typingIndicatorId);

                setTimeout(() => {
                    let responseText = "";
                    const lowerCasePrompt = prompt.toLowerCase();
                    
                    if (lowerCasePrompt.includes("‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô")) {
                        responseText = "<b>‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô (Union)</b> ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏∞ ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ñ‡∏∑‡∏≠ ‚à™ ‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏ä‡πà‡∏ô {1, 2} ‚à™ {2, 3} ‡∏à‡∏∞‡πÑ‡∏î‡πâ {1, 2, 3}";
                    } else if (lowerCasePrompt.includes("‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å")) {
                        responseText = "<b>‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å‡∏ä‡∏±‡∏ô (Intersection)</b> ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏ã‡∏ï‡∏Ñ‡πà‡∏∞ ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ñ‡∏∑‡∏≠ ‚à© ‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏ä‡πà‡∏ô {1, 2} ‚à© {2, 3} ‡∏à‡∏∞‡πÑ‡∏î‡πâ {2}";
                    } else if (persona === 'Problem Solver') {
                        responseText = "‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‡∏•‡∏≠‡∏á‡∏ß‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡πÄ‡∏ß‡∏ô‡∏ô‡πå-‡∏≠‡∏≠‡∏¢‡πÄ‡∏•‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞";
                    } else {
                        responseText = "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏ï‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?";
                    }
                    updateTypingIndicator(typingIndicatorId, responseText, chatBoxId);
                }, 1500); 
            };
            
            const appendMessage = (message, sender, chatBoxId, elementId = null) => {
                const chatBox = document.getElementById(chatBoxId);
                const messageWrapper = document.createElement('div');
                const messageBubble = document.createElement('div');
                
                messageWrapper.classList.add('flex', 'mb-4');
                if (elementId) {
                    messageWrapper.id = elementId;
                }

                let text = typeof message === 'string' ? message : message.text;

                if (sender === 'user') {
                    messageWrapper.classList.add('justify-end');
                    messageBubble.classList.add('bg-indigo-500/80', 'backdrop-blur-lg', 'border', 'border-white/20', 'text-white', 'p-3', 'rounded-lg', 'max-w-xs');
                    messageBubble.innerHTML = `<p class="text-sm">${text}</p>`;
                } else { 
                    messageWrapper.classList.add('justify-start');
                    messageBubble.classList.add('bg-white/60', 'backdrop-blur-lg', 'border', 'border-white/20', 'p-3', 'rounded-lg', 'max-w-xs');
                     if (text) {
                        messageBubble.innerHTML = `<p class="text-sm">${text}</p>`;
                    } else {
                        messageBubble.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
                    }
                }
                
                messageWrapper.appendChild(messageBubble);
                chatBox.appendChild(messageWrapper);
                chatBox.scrollTop = chatBox.scrollHeight;
            };

            const updateTypingIndicator = (indicatorId, newText, chatBoxId) => {
                 const chatBox = document.getElementById(chatBoxId);
                 const indicatorWrapper = chatBox.querySelector(`#${indicatorId}`);
                 if(indicatorWrapper) {
                    const messageBubble = indicatorWrapper.querySelector('div');
                    messageBubble.innerHTML = `<p class="text-sm">${newText}</p>`;
                 }
            };
            
            document.getElementById('study-chat-box').addEventListener('click', (e) => {
                if (e.target.dataset.actionType === 'highlight') {
                    const payload = JSON.parse(e.target.dataset.actionPayload);
                    showHighlightOnVideo(payload);
                }
            });


            const setupChat = (inputId, sendId, chatBoxId, persona) => {
                const input = document.getElementById(inputId);
                const sendButton = document.getElementById(sendId);
                
                const sendMessage = () => {
                     const prompt = input.value.trim();
                    if (prompt) {
                        appendMessage(prompt, 'user', chatBoxId);
                        input.value = '';
                        callGeminiAPI(prompt, chatBoxId, persona);
                    }
                };
                
                sendButton.addEventListener('click', sendMessage);
                input.addEventListener('keyup', (e) => {
                    if(e.key === 'Enter') {
                        sendMessage();
                    }
                });
            };
            
            setupChat('study-chat-input', 'study-chat-send', 'study-chat-box', 'Study Buddy');
            setupChat('solver-chat-input', 'solver-chat-send', 'solver-chat-box', 'Problem Solver');


            // --- Arcade Mode Logic ---
            const arcadeMenu = document.getElementById('arcade-menu');
            const flashcardModeContent = document.getElementById('flashcard-mode-content');
            const speedQuizModeContent = document.getElementById('speed-quiz-mode-content');
            const setOperationsGameContent = document.getElementById('set-operations-game-content');
            const vennDiagramGameContent = document.getElementById('venn-diagram-game-content');
            const venn3DiagramGameContent = document.getElementById('venn-3-diagram-game-content');
            const arcadeHighScoreEl = document.getElementById('arcade-high-score');
            
            const updateArcadeHighScore = () => {
                const user = auth.currentUser;
                if (user) {
                    db.collection('users').doc(user.uid).get().then(doc => {
                        if (doc.exists && doc.data().highScore) {
                             arcadeHighScoreEl.textContent = doc.data().highScore;
                        } else {
                            arcadeHighScoreEl.textContent = 0;
                        }
                    }).catch(error => {
                        console.error("Error getting high score from Firestore:", error);
                    });
                }
            }


            document.getElementById('start-flashcard-mode').addEventListener('click', () => {
                arcadeMenu.classList.add('hidden');
                flashcardModeContent.classList.add('flex');
                flashcardModeContent.classList.remove('hidden');
            });
            document.getElementById('start-speed-mode').addEventListener('click', () => {
                arcadeMenu.classList.add('hidden');
                speedQuizModeContent.classList.remove('hidden');
            });
             document.getElementById('start-set-operations-game').addEventListener('click', () => {
                arcadeMenu.classList.add('hidden');
                setOperationsGameContent.classList.remove('hidden');
                startSetOpGame();
            });
             document.getElementById('start-venn-diagram-game').addEventListener('click', () => {
                arcadeMenu.classList.add('hidden');
                vennDiagramGameContent.classList.remove('hidden');
                startVennDiagramGame();
            });
             document.getElementById('start-venn-3-diagram-game').addEventListener('click', () => {
                arcadeMenu.classList.add('hidden');
                venn3DiagramGameContent.classList.remove('hidden');
                startVenn3DiagramGame();
            });

            document.querySelectorAll('.back-to-arcade-menu').forEach(button => {
                button.addEventListener('click', () => {
                    flashcardModeContent.classList.add('hidden');
                    flashcardModeContent.classList.remove('flex');
                    speedQuizModeContent.classList.add('hidden');
                    setOperationsGameContent.classList.add('hidden');
                    vennDiagramGameContent.classList.add('hidden');
                    venn3DiagramGameContent.classList.add('hidden');
                    arcadeMenu.classList.remove('hidden');
                    if (gameAnimationId) endGame(true);
                    updateArcadeHighScore();
                });
            });


            const flashcards = [
                { term: "‡πÄ‡∏ã‡∏ï (Set)", definition: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô" },
                { term: "‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Element)", definition: "‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ã‡∏ï" },
                { term: "‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á (Empty Set)", definition: "‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏•‡∏¢ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ó‡∏ô‡∏î‡πâ‡∏ß‡∏¢ { } ‡∏´‡∏£‡∏∑‡∏≠ ‚àÖ" },
                { term: "‡πÄ‡∏ã‡∏ï‡∏à‡∏≥‡∏Å‡∏±‡∏î (Finite Set)", definition: "‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ" },
                { term: "‡πÄ‡∏ã‡∏ï‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå (Infinite Set)", definition: "‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏ã‡∏ï‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡πâ‡∏ß‡∏ô" },
                { term: "‡∏™‡∏±‡∏ö‡πÄ‡∏ã‡∏ï (Subset)", definition: "‡πÄ‡∏ã‡∏ï A ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏±‡∏ö‡πÄ‡∏ã‡∏ï‡∏Ç‡∏≠‡∏á B ‡∏ñ‡πâ‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á A ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á B" },
                { term: "‡πÄ‡∏û‡∏≤‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏ï (Power Set)", definition: "‡πÄ‡∏ã‡∏ï‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ö‡πÄ‡∏ã‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡∏ô‡∏±‡πâ‡∏ô" },
                { term: "‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô (Union)", definition: "‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô" },
                { term: "‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å‡∏ä‡∏±‡∏ô (Intersection)", definition: "‡πÄ‡∏ã‡∏ï‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏ã‡∏ï‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î" },
                { term: "‡∏Ñ‡∏≠‡∏°‡∏û‡∏•‡∏µ‡πÄ‡∏°‡∏ô‡∏ï‡πå (Complement)", definition: "‡πÄ‡∏ã‡∏ï‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏†‡∏û‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ó‡∏ò‡πå ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ã‡∏ï‡∏ô‡∏±‡πâ‡∏ô" }
            ];
            let currentCardIndex = 0;
            const cardInner = document.getElementById('flashcard-inner');
            const frontText = document.getElementById('flashcard-front-text');
            const backText = document.getElementById('flashcard-back-text');
            const cardCounter = document.getElementById('flashcard-counter');

            const showCard = (index) => {
                frontText.innerHTML = flashcards[index].term;
                backText.innerHTML = flashcards[index].definition;
                cardCounter.textContent = `${index + 1} / ${flashcards.length}`;
                cardInner.classList.remove('is-flipped');
            };

            document.getElementById('flip-flashcard').addEventListener('click', () => {
                cardInner.classList.toggle('is-flipped');
            });
            document.getElementById('next-flashcard').addEventListener('click', () => {
                currentCardIndex = (currentCardIndex + 1) % flashcards.length;
                showCard(currentCardIndex);
            });
            document.getElementById('prev-flashcard').addEventListener('click', () => {
                currentCardIndex = (currentCardIndex - 1 + flashcards.length) % flashcards.length;
                showCard(currentCardIndex);
            });

            showCard(currentCardIndex);


            // --- Speed Quiz Game Logic ---
            const speedQuizGameArea = document.getElementById('speed-quiz-game-area');
            const speedQuizTimerEl = document.getElementById('speed-quiz-timer-top');
            const speedQuizScoreEl = document.getElementById('speed-quiz-score-top');
            const speedQuizQuestionArea = document.getElementById('speed-quiz-question-area');
            const speedQuizQuestionTextEl = document.getElementById('speed-quiz-question-text');
            const speedQuizStartOverlay = document.getElementById('speed-quiz-start-overlay');
            const countdownOverlay = document.getElementById('countdown-overlay');
            const countdownText = document.getElementById('countdown-text');
            const speedQuizEndOverlay = document.getElementById('speed-quiz-end-overlay');
            const finalScoreEl = document.getElementById('final-score');
            const highScoreEl = document.getElementById('high-score');
            const laserCanvas = document.getElementById('laser-canvas');
            const laserCtx = laserCanvas.getContext('2d');
            const backgroundCanvas = document.getElementById('background-canvas');
            const bgCtx = backgroundCanvas.getContext('2d');
            const confettiCanvas = document.getElementById('confetti-canvas');
            const confettiCtx = confettiCanvas.getContext('2d');
            
            let speedQuizTimer;
            let speedQuizScore = 0;
            let timerInterval;
            let speedQuizCurrentQuestion = {};
            let bubbles = [];
            let gameAnimationId;
            let stars = [];
            let particles = [];
            let lasers = [];
            let confetti = [];
            
            const speedQuizQuestions = flashcards.map(f => {
                const wrongAnswers = flashcards
                    .filter(wa => wa.term !== f.term)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(wa => wa.term);
                return {
                    question: f.definition,
                    options: [f.term, ...wrongAnswers].sort(() => 0.5 - Math.random()),
                    correctAnswer: f.term
                }
            });

             // --- Confetti setup ---
            const setupConfetti = () => {
                const gameRect = speedQuizGameArea.getBoundingClientRect();
                confettiCanvas.width = gameRect.width;
                confettiCanvas.height = gameRect.height;
                confetti = [];
                const confettiCount = 200;
                const colors = ['#f9a8d4', '#a78bfa', '#818cf8', '#60a5fa', '#fde047'];
                for(let i = 0; i < confettiCount; i++) {
                    confetti.push({
                        x: Math.random() * gameRect.width,
                        y: -Math.random() * gameRect.height,
                        radius: Math.random() * 4 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        speed: Math.random() * 3 + 2,
                        angle: Math.random() * Math.PI * 2,
                        spin: (Math.random() - 0.5) * 0.1
                    });
                }
            };
            const drawConfetti = () => {
                confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
                confetti.forEach(c => {
                    confettiCtx.fillStyle = c.color;
                    confettiCtx.beginPath();
                    confettiCtx.save();
                    confettiCtx.translate(c.x, c.y);
                    confettiCtx.rotate(c.angle);
                    confettiCtx.fillRect(-c.radius, -c.radius / 2, c.radius * 2, c.radius);
                    confettiCtx.restore();
                });
            };
            const updateConfetti = () => {
                confetti.forEach(c => {
                    c.y += c.speed;
                    c.angle += c.spin;
                    if(c.y > confettiCanvas.height) {
                        c.y = -10;
                        c.x = Math.random() * confettiCanvas.width;
                    }
                });
            };


            // --- Starfield setup ---
            const setupStarfield = () => {
                const gameRect = speedQuizGameArea.getBoundingClientRect();
                backgroundCanvas.width = gameRect.width;
                backgroundCanvas.height = gameRect.height;
                stars = [];
                for (let i = 0; i < 100; i++) {
                    stars.push({
                        x: Math.random() * gameRect.width,
                        y: Math.random() * gameRect.height,
                        radius: Math.random() * 1.5,
                        speed: Math.random() * 0.5 + 0.2
                    });
                }
            }

            const drawStarfield = () => {
                bgCtx.clearRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
                bgCtx.fillStyle = 'white';
                stars.forEach(star => {
                    bgCtx.beginPath();
                    bgCtx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    bgCtx.fill();
                });
            }

            const updateStarfield = () => {
                stars.forEach(star => {
                    star.y += star.speed;
                    if (star.y > backgroundCanvas.height) {
                        star.y = 0;
                        star.x = Math.random() * backgroundCanvas.width;
                    }
                });
            }

            // --- Particle Explosion setup ---
             const createHitRing = (x, y, color) => {
                particles.push({
                    x, y, color,
                    radius: 20,
                    life: 30,
                    type: 'ring'
                });
            }
            
            const drawLasers = () => {
                 lasers.forEach(laser => {
                    laserCtx.beginPath();
                    laserCtx.moveTo(laser.startX, laser.startY);
                    laserCtx.lineTo(laser.x, laser.y);
                    laserCtx.strokeStyle = 'white';
                    laserCtx.lineWidth = 3;
                    laserCtx.shadowColor = '#7DF0E5';
                    laserCtx.shadowBlur = 15;
                    laserCtx.stroke();
                });
                laserCtx.shadowBlur = 0;
            }

            const drawParticles = () => {
                // Particles are drawn on the laser canvas to be on top
                particles.forEach(p => {
                    if (p.type === 'ring') {
                        laserCtx.beginPath();
                        laserCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        laserCtx.strokeStyle = `rgba(255, 255, 255, ${p.life / 30})`;
                        laserCtx.lineWidth = 2;
                        laserCtx.stroke();
                    }
                });
                laserCtx.globalAlpha = 1.0; // Reset alpha
            }

            const updateLasersAndParticles = () => {
                 for (let i = lasers.length - 1; i >= 0; i--) {
                    const l = lasers[i];
                    l.progress += l.speed;
                    l.x = l.startX + l.dx * l.progress;
                    l.y = l.startY + l.dy * l.progress;
                    
                    if (l.progress >= 1) {
                         const bubble = bubbles.find(b => b.id === l.targetId);
                        if(bubble) {
                             createHitRing(l.endX, l.endY);
                             if (bubble.el.dataset.isCorrect === 'true') {
                                 bubble.isHit = true;
                            } else {
                                 bubble.el.style.animation = 'shake 0.5s';
                                 setTimeout(() => { bubble.el.style.animation = '' }, 500);
                            }
                        }
                        lasers.splice(i, 1);
                    }
                 }
                
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    if (p.type === 'ring') {
                        p.radius += 2;
                    }
                    p.life--;
                    if (p.life <= 0) {
                        particles.splice(i, 1);
                    }
                }
            }
            
            const startCountdown = () => {
                speedQuizStartOverlay.classList.add('hidden');
                speedQuizEndOverlay.classList.add('hidden');
                countdownOverlay.classList.remove('hidden');
                countdownOverlay.classList.add('flex');
                countdownText.classList.remove('countdown-number');
                void countdownText.offsetWidth; // Trigger reflow
                countdownText.classList.add('countdown-number');
                let count = 3;
                countdownText.textContent = count;
                const countdownInterval = setInterval(() => {
                    count--;
                    if(count > 0) {
                        countdownText.textContent = count;
                        countdownText.classList.remove('countdown-number');
                        void countdownText.offsetWidth; // Trigger reflow
                        countdownText.classList.add('countdown-number');
                    } else if (count === 0) {
                        countdownText.textContent = "BLAST!";
                        countdownText.classList.remove('countdown-number');
                        void countdownText.offsetWidth; // Trigger reflow
                        countdownText.classList.add('countdown-number');
                    }
                    else {
                        clearInterval(countdownInterval);
                        countdownOverlay.classList.add('hidden');
                        countdownOverlay.classList.remove('flex');
                        startGame();
                    }
                }, 1000);
            }

            const startGame = () => {
                speedQuizQuestionArea.classList.remove('opacity-0');
                speedQuizScore = 0;
                speedQuizScoreEl.textContent = speedQuizScore;
                setupStarfield();
                startTimer();
                nextSpeedQuestion(true); // isFirstQuestion = true
                gameLoop();
            }

            const startTimer = () => {
                let timeLeft = 30;
                speedQuizTimerEl.textContent = timeLeft;
                timerInterval = setInterval(() => {
                    timeLeft--;
                    speedQuizTimerEl.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }

            const endGame = (isSilent = false) => {
                clearInterval(timerInterval);
                cancelAnimationFrame(gameAnimationId);
                gameAnimationId = null;
                timerInterval = null;
                speedQuizQuestionArea.classList.add('opacity-0');

                if (isSilent) return;

                const user = auth.currentUser;
                if (user) {
                    const userDocRef = db.collection('users').doc(user.uid);
                    userDocRef.get().then(doc => {
                        const currentHighScore = (doc.exists && doc.data().highScore) ? doc.data().highScore : 0;
                        if (speedQuizScore > currentHighScore) {
                            userDocRef.set({ highScore: speedQuizScore }, { merge: true });
                            highScoreEl.textContent = speedQuizScore;
                        } else {
                            highScoreEl.textContent = currentHighScore;
                        }
                    });
                }


                finalScoreEl.textContent = speedQuizScore;
                speedQuizEndOverlay.classList.remove('hidden');
                speedQuizEndOverlay.classList.add('flex');
                setupConfetti();

                bubbles.forEach(b => b.el.remove());
                bubbles = [];
                particles = [];
                lasers = [];
            }
            
            const gameLoop = () => {
                const gameRect = speedQuizGameArea.getBoundingClientRect();
                if (laserCanvas.width !== gameRect.width || laserCanvas.height !== gameRect.height) {
                    laserCanvas.width = gameRect.width;
                    laserCanvas.height = gameRect.height;
                    backgroundCanvas.width = gameRect.width;
                    backgroundCanvas.height = gameRect.height;
                    confettiCanvas.width = gameRect.width;
                    confettiCanvas.height = gameRect.height;
                }

                laserCtx.clearRect(0, 0, laserCanvas.width, laserCanvas.height);
                
                if (!timerInterval) { // Paused or ended
                    if(confetti.length > 0) {
                        updateConfetti();
                        drawConfetti();
                    }
                } else { // Playing
                    updateBubbles();
                    updateStarfield();
                    drawStarfield();
                    updateLasersAndParticles();
                }

                drawLasers();
                drawParticles();
                gameAnimationId = requestAnimationFrame(gameLoop);
            }

            const updateBubbles = () => {
                const gameRect = speedQuizGameArea.getBoundingClientRect();
                bubbles.forEach(bubble => {
                     if (bubble.isHit) {
                        bubble.el.style.opacity = Math.max(0, parseFloat(bubble.el.style.opacity) - 0.05);
                        if (parseFloat(bubble.el.style.opacity) <= 0) {
                            // Will be handled by next question logic
                        }
                        return;
                    }

                    bubble.x += bubble.vx;
                    bubble.y += bubble.vy;

                    if (bubble.x <= 0 || bubble.x + bubble.el.offsetWidth >= gameRect.width) {
                        bubble.vx *= -1; 
                    }
                    if (bubble.y <= 64 || bubble.y + bubble.el.offsetHeight >= gameRect.height - 120) { // Keep away from top/bottom
                        bubble.vy *= -1;
                    }

                    bubble.x = Math.max(0, Math.min(bubble.x, gameRect.width - bubble.el.offsetWidth));
                    bubble.y = Math.max(64, Math.min(bubble.y, gameRect.height - 120 - bubble.el.offsetHeight));

                    bubble.el.style.transform = `translate(${bubble.x}px, ${bubble.y}px)`;
                });
            }

            const nextSpeedQuestion = (isFirstQuestion = false) => {
                if (!timerInterval) return;

                speedQuizCurrentQuestion = speedQuizQuestions[Math.floor(Math.random() * speedQuizQuestions.length)];
                speedQuizQuestionTextEl.innerHTML = speedQuizCurrentQuestion.question;

                const gameRect = speedQuizGameArea.getBoundingClientRect();

                if (isFirstQuestion) {
                    bubbles.forEach(b => b.el.remove());
                    bubbles = [];
                    speedQuizCurrentQuestion.options.forEach((option, index) => {
                         const bubbleEl = document.createElement('div');
                        bubbleEl.classList.add('bubble', 'absolute', 'cursor-pointer', 'flex', 'items-center', 'justify-center', 'text-center', 'p-2', 'text-white', 'font-semibold', 'rounded-full', 'bg-purple-500/70', 'backdrop-blur-sm', 'border', 'border-purple-300/50', 'shadow-lg', 'transition-opacity', 'duration-300');
                        bubbleEl.style.width = '140px';
                        bubbleEl.style.height = '140px';
                        bubbleEl.style.fontSize = '14px';
                        bubbleEl.style.zIndex = '10';
                        
                        const bubbleId = `bubble-${Date.now()}-${index}`;

                        const bubble = {
                            id: bubbleId,
                            el: bubbleEl,
                            isHit: false,
                            x: Math.random() * (gameRect.width - 140),
                            y: (Math.random() * (gameRect.height - 420)) + 80,
                            vx: (Math.random() - 0.5) * 2,
                            vy: (Math.random() - 0.5) * 2,
                        };
                        bubbleEl.dataset.id = bubbleId;
                        bubbles.push(bubble);
                        speedQuizGameArea.appendChild(bubbleEl);
                        bubbleEl.addEventListener('click', handleBubbleClick);
                    });
                }
                
                // Assign new options to all bubbles
                const shuffledOptions = [...speedQuizCurrentQuestion.options].sort(() => 0.5 - Math.random());
                bubbles.forEach((bubble, index) => {
                    bubble.el.innerHTML = shuffledOptions[index];
                    bubble.el.dataset.answer = shuffledOptions[index];
                    bubble.isHit = false;
                    bubble.el.style.opacity = 1;
                    bubble.el.style.pointerEvents = 'auto';
                });
            }
            
            const shootLaser = (targetBubble) => {
                const shooter = document.getElementById('shooter-container');
                const shooterRect = shooter.getBoundingClientRect();
                const gameAreaRect = speedQuizGameArea.getBoundingClientRect();
                const bubbleRect = targetBubble.getBoundingClientRect();

                const startX = shooterRect.left + shooterRect.width / 2 - gameAreaRect.left;
                const startY = shooterRect.top - gameAreaRect.top;
                
                const centerX = bubbleRect.left + bubbleRect.width / 2 - gameAreaRect.left;
                const centerY = bubbleRect.top + bubbleRect.height / 2 - gameAreaRect.top;
                
                const distance = Math.sqrt(Math.pow(centerX - startX, 2) + Math.pow(centerY - startY, 2));
                const laserSpeed = 1 / (distance / 30); // Adjust divisor for speed

                lasers.push({
                    startX, startY, endX: centerX, endY: centerY,
                    x: startX, y: startY,
                    dx: centerX - startX, dy: centerY - startY,
                    progress: 0,
                    speed: laserSpeed,
                    targetId: targetBubble.dataset.id
                });
            }

            const handleBubbleClick = (e) => {
                if (!timerInterval || lasers.length > 0) return; 
                const selectedBubbleEl = e.currentTarget;
                const selectedAnswer = selectedBubbleEl.dataset.answer;
                
                bubbles.forEach(b => b.el.style.pointerEvents = 'none');
                
                const isCorrect = selectedAnswer === speedQuizCurrentQuestion.correctAnswer;
                selectedBubbleEl.dataset.isCorrect = isCorrect;
                
                shootLaser(selectedBubbleEl);
                
                setTimeout(() => {
                    if (isCorrect) {
                        speedQuizScore += 10;
                        speedQuizScoreEl.textContent = speedQuizScore;
                        nextSpeedQuestion();
                    } else {
                        speedQuizScore = Math.max(0, speedQuizScore - 5);
                         speedQuizScoreEl.textContent = speedQuizScore;
                         bubbles.forEach(b => b.el.style.pointerEvents = 'auto');
                    }
                }, 500); // Wait for laser animation
            }

            document.getElementById('speed-quiz-start-btn').addEventListener('click', startCountdown);
            document.getElementById('speed-quiz-restart-btn').addEventListener('click', () => {
                 speedQuizEndOverlay.classList.remove('flex');
                 speedQuizEndOverlay.classList.add('hidden');
                 startCountdown();
            });

            // --- Set Operations Game Logic ---
            const setOpGameContent = document.getElementById('set-operations-game-content');
            const setOpScoreEl = document.getElementById('set-op-score');
            const setOpQuestionEl = document.getElementById('set-op-question');
            const setADisplay = document.getElementById('set-a-display');
            const setBDisplay = document.getElementById('set-b-display');
            const dropZone = document.getElementById('set-op-drop-zone');
            const elementPool = document.getElementById('set-op-element-pool');
            const checkBtn = document.getElementById('set-op-check-btn');
            const resetBtn = document.getElementById('set-op-reset-btn');
            const feedbackEl = document.getElementById('set-op-feedback');

            let setOpScore = 0;
            let currentSetA = [];
            let currentSetB = [];
            let currentOperation = '';
            let currentCorrectAnswer = [];
            
            const operations = [
                { type: 'union', symbol: '‚à™', label: '‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô' },
                { type: 'intersection', symbol: '‚à©', label: '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å‡∏ä‡∏±‡∏ô' },
                { type: 'differenceA', symbol: '‚àí', label: '‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (A - B)' },
                { type: 'differenceB', symbol: '‚àí', label: '‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á (B - A)' }
            ];

            function generateRandomSet(size, min, max) {
                const s = new Set();
                while(s.size < size) {
                    s.add(Math.floor(Math.random() * (max - min + 1)) + min);
                }
                return Array.from(s).sort((a,b) => a-b);
            }

            function generateSetOpProblem() {
                feedbackEl.textContent = '';
                currentSetA = generateRandomSet(Math.floor(Math.random() * 3) + 3, 1, 10); // 3-5 elements
                currentSetB = generateRandomSet(Math.floor(Math.random() * 3) + 3, 1, 10);
                currentOperation = operations[Math.floor(Math.random() * operations.length)];

                // Calculate Correct Answer
                const setA = new Set(currentSetA);
                const setB = new Set(currentSetB);
                switch(currentOperation.type) {
                    case 'union':
                        currentCorrectAnswer = Array.from(new Set([...currentSetA, ...currentSetB])).sort((a,b)=>a-b);
                        setOpQuestionEl.textContent = `‡∏à‡∏á‡∏´‡∏≤: A ${currentOperation.symbol} B`;
                        break;
                    case 'intersection':
                        currentCorrectAnswer = currentSetA.filter(x => setB.has(x)).sort((a,b)=>a-b);
                        setOpQuestionEl.textContent = `‡∏à‡∏á‡∏´‡∏≤: A ${currentOperation.symbol} B`;
                        break;
                    case 'differenceA':
                        currentCorrectAnswer = currentSetA.filter(x => !setB.has(x)).sort((a,b)=>a-b);
                         setOpQuestionEl.textContent = `‡∏à‡∏á‡∏´‡∏≤: A ${currentOperation.symbol} B`;
                        break;
                    case 'differenceB':
                         currentCorrectAnswer = currentSetB.filter(x => !setA.has(x)).sort((a,b)=>a-b);
                         setOpQuestionEl.textContent = `‡∏à‡∏á‡∏´‡∏≤: B ${currentOperation.symbol} A`;
                        break;
                }
                
                // Populate UI
                setADisplay.textContent = `{ ${currentSetA.join(', ')} }`;
                setBDisplay.textContent = `{ ${currentSetB.join(', ')} }`;

                // Create element pool
                const allElements = Array.from(new Set([...currentSetA, ...currentSetB, ...generateRandomSet(3, 1, 15)]));
                elementPool.innerHTML = '';
                allElements.sort(() => 0.5 - Math.random()).forEach(el => {
                    const elDiv = document.createElement('div');
                    elDiv.className = 'set-op-element';
                    elDiv.textContent = el;
                    elDiv.draggable = true;
                    elDiv.dataset.value = el;
                    elementPool.appendChild(elDiv);
                });

                resetAnswer();
            }

            function startSetOpGame() {
                setOpScore = 0;
                setOpScoreEl.textContent = setOpScore;
                generateSetOpProblem();
            }
            
            function checkAnswer() {
                const droppedElements = Array.from(dropZone.children);
                const userAnswer = droppedElements.map(el => parseInt(el.dataset.value)).sort((a,b)=>a-b);

                const isCorrect = JSON.stringify(userAnswer) === JSON.stringify(currentCorrectAnswer);

                if (isCorrect) {
                    setOpScore += 10;
                    setOpScoreEl.textContent = setOpScore;
                    feedbackEl.textContent = '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!';
                    feedbackEl.className = 'text-center mb-4 h-6 font-semibold text-green-600';
                    setTimeout(generateSetOpProblem, 1500);
                } else {
                    feedbackEl.textContent = '‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!';
                    feedbackEl.className = 'text-center mb-4 h-6 font-semibold text-red-600';
                    dropZone.classList.add('animate-shake'); // Simple shake animation
                    setTimeout(() => {
                        feedbackEl.textContent = '';
                        dropZone.classList.remove('animate-shake');
                    }, 1500);
                }
            }
            
            function resetAnswer() {
                dropZone.innerHTML = '';
                Array.from(elementPool.children).forEach(el => {
                    el.classList.remove('dragged');
                    el.draggable = true;
                });
            }

            // Drag and Drop Logic
            let draggedItem = null;
            
            elementPool.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('set-op-element') && !e.target.classList.contains('dragged')) {
                    draggedItem = e.target;
                    setTimeout(() => e.target.style.display = 'none', 0);
                }
            });

            elementPool.addEventListener('dragend', (e) => {
                if (draggedItem) {
                    setTimeout(() => {
                        draggedItem.style.display = 'block';
                        draggedItem = null;
                    }, 0);
                }
            });

            dropZone.addEventListener('dragover', e => e.preventDefault());
            dropZone.addEventListener('dragenter', e => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                if(draggedItem) {
                    const newEl = draggedItem.cloneNode(true);
                    newEl.draggable = false;
                    newEl.addEventListener('click', (ev) => {
                        const originalEl = Array.from(elementPool.children).find(child => child.dataset.value === ev.target.dataset.value);
                        if(originalEl) {
                           originalEl.classList.remove('dragged');
                           originalEl.draggable = true;
                        }
                        ev.target.remove();
                    });
                    dropZone.appendChild(newEl);
                    draggedItem.classList.add('dragged');
                    draggedItem.draggable = false;
                }
                dropZone.classList.remove('drag-over');
            });


            checkBtn.addEventListener('click', checkAnswer);
            resetBtn.addEventListener('click', resetAnswer);

             // --- Venn Diagram Game Logic (2 sets) ---
            const vennScoreEl = document.getElementById('venn-score');
            const vennUniverseSetEl = document.getElementById('venn-universe-set');
            const vennElementPool = document.getElementById('venn-element-pool');
            const vennDropAreas = {
                a: document.getElementById('venn-drop-a'),
                b: document.getElementById('venn-drop-b'),
                intersection: document.getElementById('venn-drop-intersection'),
                universe: document.getElementById('venn-drop-universe'),
            };
            const vennCheckBtn = document.getElementById('venn-check-btn');
            const vennFeedbackEl = document.getElementById('venn-feedback');
            
            let vennScore = 0;
            let vennProblem = {};

            function startVennDiagramGame() {
                vennScore = 0;
                vennScoreEl.textContent = vennScore;
                generateVennProblem();
            }

            function generateVennProblem() {
                vennFeedbackEl.textContent = '';
                const U = Array.from({length: 12}, (_, i) => i + 1);
                const A = new Set(generateRandomSet(5, 1, 12));
                const B = new Set(generateRandomSet(5, 1, 12));

                vennProblem = {
                    U,
                    A: Array.from(A).sort((a,b)=>a-b),
                    B: Array.from(B).sort((a,b)=>a-b),
                    solution: {
                        a: [],
                        b: [],
                        intersection: [],
                        universe: []
                    }
                };

                U.forEach(num => {
                    const inA = A.has(num);
                    const inB = B.has(num);
                    if (inA && inB) vennProblem.solution.intersection.push(num);
                    else if (inA) vennProblem.solution.a.push(num);
                    else if (inB) vennProblem.solution.b.push(num);
                    else vennProblem.solution.universe.push(num);
                });

                vennUniverseSetEl.textContent = U.join(', ');
                document.getElementById('venn-set-a-display').textContent = `{ ${vennProblem.A.join(', ')} }`;
                document.getElementById('venn-set-b-display').textContent = `{ ${vennProblem.B.join(', ')} }`;
                
                vennElementPool.innerHTML = '';
                U.sort(() => 0.5 - Math.random()).forEach(num => {
                    const el = document.createElement('div');
                    el.className = 'venn-element';
                    el.textContent = num;
                    el.draggable = true;
                    el.dataset.value = num;
                    vennElementPool.appendChild(el);
                });

                Object.values(vennDropAreas).forEach(area => area.innerHTML = '');
            }
            
            function checkVennAnswer() {
                let isCorrect = true;
                for (const zone in vennDropAreas) {
                    const userAnswers = Array.from(vennDropAreas[zone].children)
                                            .map(el => parseInt(el.textContent))
                                            .sort((a,b) => a - b);
                    const correctAnswers = vennProblem.solution[zone].sort((a,b) => a - b);
                    if (JSON.stringify(userAnswers) !== JSON.stringify(correctAnswers)) {
                        isCorrect = false;
                        break;
                    }
                }
                
                if(isCorrect) {
                    vennScore += 10;
                    vennScoreEl.textContent = vennScore;
                    vennFeedbackEl.textContent = '‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
                    vennFeedbackEl.className = 'text-center my-4 h-6 font-semibold text-green-600';
                    setTimeout(generateVennProblem, 2000);
                } else {
                    vennFeedbackEl.textContent = '‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞';
                    vennFeedbackEl.className = 'text-center my-4 h-6 font-semibold text-red-600';
                }
            }

           // --- Venn Drag and Drop (using SortableJS for Mobile/Desktop) ---

// ** For the 2-Set Venn Diagram Game **
const venn2Pool = document.getElementById('venn-element-pool');
const allVenn2DropZones = [venn2Pool, ...Object.values(vennDropAreas)];

allVenn2DropZones.forEach(zone => {
    new Sortable(zone, {
        group: 'venn2', // Allows items to be dragged between these containers
        animation: 150, // Animation speed in ms
        draggable: '.venn-element', // Specifies which items are draggable
        ghostClass: 'dragged' // The class for the semi-transparent clone
    });
});

            vennCheckBtn.addEventListener('click', checkVennAnswer);

            // --- Venn Diagram Game Logic (3 sets) ---
            const venn3ScoreEl = document.getElementById('venn-3-score');
            const venn3UniverseSetEl = document.getElementById('venn-3-universe-set');
            const venn3SetADisplay = document.getElementById('venn-3-set-a-display');
            const venn3SetBDisplay = document.getElementById('venn-3-set-b-display');
            const venn3SetCDisplay = document.getElementById('venn-3-set-c-display');
            const venn3ElementPool = document.getElementById('venn-3-element-pool');
            const venn3DropAreas = {
                a_only: document.getElementById('venn-3-drop-a'),
                b_only: document.getElementById('venn-3-drop-b'),
                c_only: document.getElementById('venn-3-drop-c'),
                ab_only: document.getElementById('venn-3-drop-ab'),
                ac_only: document.getElementById('venn-3-drop-ac'),
                bc_only: document.getElementById('venn-3-drop-bc'),
                abc_intersect: document.getElementById('venn-3-drop-abc'),
                universe: document.getElementById('venn-3-drop-universe'),
            };
            const venn3CheckBtn = document.getElementById('venn-3-check-btn');
            const venn3FeedbackEl = document.getElementById('venn-3-feedback');
            
            let venn3Score = 0;
            let venn3Problem = {};

            function startVenn3DiagramGame() {
                venn3Score = 0;
                venn3ScoreEl.textContent = venn3Score;
                generateVenn3Problem();
            }

            function generateVenn3Problem() {
                venn3FeedbackEl.textContent = '';
                const U = Array.from({length: 15}, (_, i) => i + 1);
                const A = new Set(generateRandomSet(6, 1, 15));
                const B = new Set(generateRandomSet(6, 1, 15));
                const C = new Set(generateRandomSet(6, 1, 15));

                venn3Problem = {
                    U,
                    A: Array.from(A).sort((a,b)=>a-b),
                    B: Array.from(B).sort((a,b)=>a-b),
                    C: Array.from(C).sort((a,b)=>a-b),
                    solution: {
                        a_only: [], b_only: [], c_only: [],
                        ab_only: [], ac_only: [], bc_only: [],
                        abc_intersect: [], universe: []
                    }
                };

                U.forEach(num => {
                    const inA = A.has(num);
                    const inB = B.has(num);
                    const inC = C.has(num);
                    if (inA && inB && inC) venn3Problem.solution.abc_intersect.push(num);
                    else if (inA && inB) venn3Problem.solution.ab_only.push(num);
                    else if (inA && inC) venn3Problem.solution.ac_only.push(num);
                    else if (inB && inC) venn3Problem.solution.bc_only.push(num);
                    else if (inA) venn3Problem.solution.a_only.push(num);
                    else if (inB) venn3Problem.solution.b_only.push(num);
                    else if (inC) venn3Problem.solution.c_only.push(num);
                    else venn3Problem.solution.universe.push(num);
                });

                venn3UniverseSetEl.textContent = U.join(', ');
                venn3SetADisplay.textContent = `{ ${venn3Problem.A.join(', ')} }`;
                venn3SetBDisplay.textContent = `{ ${venn3Problem.B.join(', ')} }`;
                venn3SetCDisplay.textContent = `{ ${venn3Problem.C.join(', ')} }`;
                
                venn3ElementPool.innerHTML = '';
                U.sort(() => 0.5 - Math.random()).forEach(num => {
                    const el = document.createElement('div');
                    el.className = 'venn-element';
                    el.textContent = num;
                    el.draggable = true;
                    el.dataset.value = num;
                    venn3ElementPool.appendChild(el);
                });
                
                Object.values(venn3DropAreas).forEach(area => area.innerHTML = '');
            }

            function checkVenn3Answer() {
                 let isCorrect = true;
                for (const zone in venn3DropAreas) {
                    const userAnswers = Array.from(venn3DropAreas[zone].children)
                                            .map(el => parseInt(el.textContent))
                                            .sort((a,b) => a - b);
                    const correctAnswers = venn3Problem.solution[zone].sort((a,b) => a - b);
                    if (JSON.stringify(userAnswers) !== JSON.stringify(correctAnswers)) {
                        isCorrect = false;
                        break;
                    }
                }
                
                if(isCorrect) {
                    venn3Score += 15;
                    venn3ScoreEl.textContent = venn3Score;
                    venn3FeedbackEl.textContent = '‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
                    venn3FeedbackEl.className = 'text-center my-4 h-6 font-semibold text-green-600';
                    setTimeout(generateVenn3Problem, 2000);
                } else {
                    venn3FeedbackEl.textContent = '‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞';
                    venn3FeedbackEl.className = 'text-center my-4 h-6 font-semibold text-red-600';
                }
            }
// ** For the 3-Set Venn Diagram Game **
const venn3Pool = document.getElementById('venn-3-element-pool');
const allVenn3DropZones = [venn3Pool, ...Object.values(venn3DropAreas)];

allVenn3DropZones.forEach(zone => {
    new Sortable(zone, {
        group: 'venn3', // A different group name to keep this game separate
        animation: 150,
        draggable: '.venn-element',
        ghostClass: 'dragged'
    });
});
             venn3CheckBtn.addEventListener('click', checkVenn3Answer);

            const quizModal = document.getElementById('quiz-modal');
            const quizProgressBar = document.getElementById('quiz-progress-bar');
            const quizLoadingModal = document.getElementById('ai-quiz-loading-modal');
            const quizContent = document.getElementById('quiz-content');
            
            let staticQuizQuestions = [
                { question: "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ñ‡∏∑‡∏≠‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á?", options: ["{0}", "{}", "0", "‚àÖ"], correctAnswer: "‚àÖ" },
                { question: "‡∏ñ‡πâ‡∏≤ A = {1, 2, 3} ‡πÅ‡∏•‡πâ‡∏ß n(A) ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["1", "2", "3", "6"], correctAnswer: "3" },
                { question: "A ‚à™ B ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏≠‡∏∞‡πÑ‡∏£?", options: ["‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô A ‡∏´‡∏£‡∏∑‡∏≠ B", "‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô A ‡πÅ‡∏•‡∏∞ B", "‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô A ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô B", "‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô A ‡πÅ‡∏•‡∏∞ B"], correctAnswer: "‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô A ‡∏´‡∏£‡∏∑‡∏≠ B" },
            ];
            let quizQuestions = [...staticQuizQuestions];

            let currentQuizQuestions = [];
            let dailyQuizCurrentQuestionIndex = 0;
            let score = 0;
            
             const generateQuizWithGemini = async () => {
                quizLoadingModal.classList.remove('hidden');
                console.log("Simulating AI quiz generation... using static fallback questions.");
                
                return new Promise(resolve => {
                    setTimeout(() => {
                        quizQuestions = [...staticQuizQuestions];
                        quizLoadingModal.classList.add('hidden');
                        resolve();
                    }, 1500);
                });
            };


            const startQuiz = async () => {
                await generateQuizWithGemini();
                currentQuizQuestions = [...quizQuestions].sort(() => 0.5 - Math.random());
                dailyQuizCurrentQuestionIndex = 0;
                score = 0;
                quizModal.classList.remove('hidden');
                showQuizQuestion();
            };

            const showQuizQuestion = () => {
                 const progress = ((dailyQuizCurrentQuestionIndex) / currentQuizQuestions.length) * 100;
                 quizProgressBar.style.width = `${progress}%`;

                if (dailyQuizCurrentQuestionIndex < currentQuizQuestions.length) {
                    const q = currentQuizQuestions[dailyQuizCurrentQuestionIndex];
                    let optionsHtml = q.options.map(option =>
                        `<button class="quiz-option w-full text-left p-4 border border-slate-200 rounded-lg hover:bg-slate-100 hover:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200">${option}</button>`
                    ).join('');

                    quizContent.innerHTML = `
                          <div>
                               <p class="text-slate-500 mb-2">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà ${dailyQuizCurrentQuestionIndex + 1} ‡∏à‡∏≤‡∏Å ${currentQuizQuestions.length}</p>
                               <p class="text-2xl font-semibold text-slate-900 mb-8">${q.question}</p>
                               <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">${optionsHtml}</div>
                          </div>
                    `;

                    document.querySelectorAll('.quiz-option').forEach(button => {
                        button.addEventListener('click', handleAnswer);
                    });
                } else {
                    showQuizResult();
                }
            };

            const handleAnswer = (e) => {
                const selectedAnswer = e.target.innerHTML;
                const correctAnswer = currentQuizQuestions[dailyQuizCurrentQuestionIndex].correctAnswer;

                if (selectedAnswer === correctAnswer) {
                    score++;
                    e.target.classList.remove('border-slate-200', 'hover:bg-slate-100');
                    e.target.classList.add('bg-green-100', 'border-green-500');
                } else {
                     e.target.classList.remove('border-slate-200', 'hover:bg-slate-100');
                     e.target.classList.add('bg-red-100', 'border-red-500');
                }
                document.querySelectorAll('.quiz-option').forEach(button => {
                    button.disabled = true;
                    if(button.innerHTML === correctAnswer) {
                        button.classList.add('!bg-green-100', '!border-green-500');
                    }
                });


                setTimeout(() => {
                    dailyQuizCurrentQuestionIndex++;
                    showQuizQuestion();
                }, 1500);
            };

            const showQuizResult = () => {
                 quizProgressBar.style.width = `100%`;
                quizContent.innerHTML = `
                     <div class="text-center">
                          <h3 class="text-4xl font-bold text-slate-800 mb-4">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!</h3>
                          <p class="text-2xl text-slate-600 mb-8">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô <span class="font-bold text-indigo-600">${score}</span> ‡∏à‡∏≤‡∏Å ${currentQuizQuestions.length} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                          <button id="close-quiz-result-btn" class="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors duration-300">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                     </div>
                `;
                document.getElementById('close-quiz-result-btn').addEventListener('click', closeQuiz);
            };
            
            const closeQuiz = () => {
                quizModal.classList.add('hidden');
            };
            
            document.getElementById('close-quiz-btn').addEventListener('click', closeQuiz);
            document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);

        });
    </script>

</body>

</html>
